<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>ZY</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="ZY">
<meta property="og:url" content="https://jyue0812.github.io/index.html">
<meta property="og:site_name" content="ZY">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ZY">
  
    <link rel="alternate" href="/blog/atom.xml" title="ZY" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">ZY</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/blog/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://jyue0812.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-2018-06-19" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/06/19/2018-06-19/" class="article-date">
  <time datetime="2018-06-19T02:27:22.562Z" itemprop="datePublished">2018-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1: 推荐网址[数据结构和算法动态可视化]（有许多实用的功能以及实现)<br>    <a href="http://www.visualgo.net/zh" target="_blank" rel="noopener">www.visualgo.net/zh</a></p>
<p>2: Cache (官方帮助文档)    <a href="https://docs.djangoproject.com/en/2.0/topics/cache/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.0/topics/cache/</a>)</p>
<pre><code>2.1 缓存框架的核心目标
    2.1.1 较少的代码
        2.1.1.1 缓存应该尽快
        2.1.1.2 围绕缓存后段的所有框架代码应该保持在绝对最小值，特别是查询
    2.1.2 一致性
    2.1.3 可扩展性

2.2 缓存，django内存的缓存框架，提供了几种常用的缓存。
    2.1 Memcached 缓存  基于内存级数据库 不流行使用了
    2.2 数据库缓存
    2.3 使用文件系统进行缓存
    2.4 使用本地内存进行缓存
    2.5 提供缓存扩展接口

2.3 缓存配置
    2.3.1
        CACHES = {
            &apos;default&apos;: {
                &apos;BACKEND&apos;: &apos;django.core.cache.backends.db.DatabaseCache&apos;,
                &apos;LOCATION&apos;: &apos;my_cache_table&apos;,
                &apos;TIMEOUT&apos;:&apos;60&apos;, //缓存时间
                &apos;OPTIONS&apos;:{
                    &apos;MAX_ENTRIES&apos;:&apos;300&apos;: //文件缓存个数
                },
                &apos;KEY_PREFIX&apos;:&apos;abc&apos;,   //前缀，用作标示
                &apos;VERSION&apos;:1,        //当前缓存版本
            }
        }
    2.3.1 创建缓存表
        python manage.py createcachetable [table_name]

2.4 缓存的使用（缓存原理图）
    在视图中使用（views，使用最多的场景）
    @cache_page()装饰器
        time 单位秒
        cache 缓存配置，默认default
        key_prefix 前置字符串


练习1： 查询用户列表实现缓存，并且使用aop打印每次访问的起始时间和结束时间。
练习2： 自我实现缓存底层
练习3： 安装redis，使用redis实现缓存
</code></pre><ol start="3">
<li><p>缓存底层   urls -&gt; views -&gt; cache -&gt; return views</p>
<pre><code>urls -&gt; views -&gt; cache -&gt; models -&gt; savecache -&gt; return views
</code></pre><p> 3.1 获取cache</p>
<pre><code>from django.core.cache import caches
cache = caches[&apos;cache_name&apos;]
</code></pre><p> 3.2 获取cache</p>
<pre><code>from django.core.cache import cache
</code></pre><p> 3.3 缓存操作</p>
<pre><code>cache.set
    key
    value
    timeout

3.3.1 get
3.3.1 add
3.3.1 get_or _set
3.3.1 get_many
3.3.1 set_many
3.3.1 delete
3.3.1 delete_many
3.3.1 clear

3.3.1 incr 增加
        incr(key, value) key对应的值上添加 value
3.3.1 decr 减少
        decr(key, value) key对应的值上减少value
        如果value不写，默认变更为1
</code></pre><p> 3.4 使用Redis做缓存,常见的有两个实现</p>
<pre><code>3.4.1 django-redis
    http://django-redis-chs.readthedocs.io/zh_CN/latest/#django
    安装插件： pip3 install django-redis
    ========================================================
    源码安装：
        make
        make test
        make install
    ========================================================
    启动redis 。  redis-server
    连接redis 。  redis-cli
    查看redis 。  keys *        进入指定块   select 1     keys*    查看缓存时间  ttl

3.4.2 django-redis-cache
    https://pypi.python.org/pypi/django-redis-cache/

3.4.3配置和内置的缓存配置基本一致

    CACHES = {
        &quot;default&quot;: {
            &quot;BACKEND&quot;: &quot;django_redis.cache.RedisCache&quot;,
            &quot;LOCATION&quot;: &quot;redis://127.0.0.1:6379/1&quot;,
            &quot;OPTIONS&quot;: {
                &quot;CLIENT_CLASS&quot;: &quot;django_redis.client.DefaultClient&quot;,
            }
        }
    }

用法和内置缓存使用一样
</code></pre></li>
</ol>
<p>4: 项目分析<br>    4。1 架构分析<br>        4。1。1 用户中心<br>        4。1。2 首页商品<br>        4。1。3 闪购（商品列表）<br>        4。1。4 购物车<br>            订单系统，收货地址，支付，优惠卷，积分系统，vip，评价模块，黑白名单，判决模块</p>
<pre><code>4。2 开发过程
    4。2。1 首页·闪购·个人模块可以并行开发
    4。2。2 新建项目，完成一些列配置

4。3 虚拟环境依赖 拷贝安装
    4。3。1 查询依赖              pip3 freeze
    4。3。2 将依赖输出至文件       pip3 freeze  &gt; requirements.txt
    4。3。3 创建新的虚拟环境后安装  pip3 install -r requirements.txt
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/06/19/2018-06-19/" data-id="cjil2pq7k0000d4qx4d8kpyuj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-flask配置套路" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/06/05/flask配置套路/" class="article-date">
  <time datetime="2018-06-05T05:54:06.494Z" itemprop="datePublished">2018-06-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>flask</p>
<p>应用内：</p>
<p>三个文件夹 + 5个python文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">static</span><br><span class="line"></span><br><span class="line">templates</span><br><span class="line"></span><br><span class="line">views</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">config.py</span><br><span class="line"></span><br><span class="line">forms.py</span><br><span class="line"></span><br><span class="line">models.py</span><br><span class="line"></span><br><span class="line">extensions.py</span><br><span class="line"></span><br><span class="line">__init__.py</span><br></pre></td></tr></table></figure>
<p>配置文件 config.py 配置 开发 测试 生产环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">basedir = os.path.abspath(os.path.dirname(__file__))</span><br><span class="line"></span><br><span class="line">class Config:</span><br><span class="line">    SECRET_KEY = os.environ.get(&apos;SECRET_KEY&apos;) or &apos;hard to guess string&apos;</span><br><span class="line">    SQLALCHEMY_COMMIT_ON_TEARDOWN = True</span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = False</span><br><span class="line">    FLASKY_POSTS_PER_PAGE = 10</span><br><span class="line"></span><br><span class="line">    FLASK_MAIL_SERVER = &apos;smtp.qq.com&apos;</span><br><span class="line">    FLASK_MAIL_PORT= 465</span><br><span class="line">    FLASK_MAIL_USE_SSL = True</span><br><span class="line">    FLASK_MAIL_USE_TLS = False</span><br><span class="line">    FLASK_MAIL_USERNAME = &apos;1678033705@qq.com&apos;</span><br><span class="line">    FLASK_MAIL_PASSWORD = &apos;coohdgjzpxsnebab&apos;</span><br><span class="line"></span><br><span class="line">    TEMPLATES_AUTO_RELOAD = True</span><br><span class="line"></span><br><span class="line">class DevelopConfig(Config):</span><br><span class="line">    DEBUG = True</span><br><span class="line">    SQLALCHEMY_DATABASE_URI = &quot;sqlite:///&quot; + os.path.join(basedir, &quot;blog-dev.sqlite&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TestingConfig(Config):</span><br><span class="line">    TESTING = True</span><br><span class="line">    SQLALCHEMY_DATABASE_URI = &quot;sqlite:///&quot; + os.path.join(basedir, &quot;blog-test.sqlite&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ProductConfig(Config):</span><br><span class="line">    SQLALCHEMY_DATABASE_URI = &quot;sqlite:///&quot; + os.path.join(basedir, &quot;blog.sqlite&quot;)</span><br><span class="line"></span><br><span class="line">config = &#123;</span><br><span class="line">    &apos;develop&apos;: DevelopConfig,</span><br><span class="line">    &apos;testing&apos;: TestingConfig,</span><br><span class="line">    &apos;products&apos;: ProductConfig,</span><br><span class="line">    &apos;default&apos;: DevelopConfig,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>init.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask</span><br><span class="line">from app.config import config</span><br><span class="line">from extensions import config_extensions</span><br><span class="line">from app.views import register_blueprint</span><br><span class="line"></span><br><span class="line">def create_app(config_name):</span><br><span class="line">    app = Flask(__name__)</span><br><span class="line">    app.config.from_object(config.get(config_name or &apos;default&apos;))</span><br><span class="line">    config_extensions(app)</span><br><span class="line">    register_blueprint(app)</span><br><span class="line">    register_blueprint(app)</span><br><span class="line">    return app</span><br></pre></td></tr></table></figure>
<p>extensions.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">from flask_bootstrap import Bootstrap</span><br><span class="line">from flask_sqlalchemy import SQLAlchemy</span><br><span class="line">from flask_migrate import Migrate</span><br><span class="line">from flask_mail import Mail</span><br><span class="line">from flask_moment import Moment</span><br><span class="line">from flask_login import LoginManager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line">boot = Bootstrap()</span><br><span class="line">migrate = Migrate(db=db)</span><br><span class="line">mail = Mail()</span><br><span class="line">moment = Moment()</span><br><span class="line">login_manager = LoginManager()</span><br><span class="line">login_manager.session_protection = &apos;strong&apos;</span><br><span class="line">login_manager.login_view = &apos;auth.login&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def config_extensions(app):</span><br><span class="line">    db.init_app(app)</span><br><span class="line">    boot.init_app(app)</span><br><span class="line">    migrate.init_app(app)</span><br><span class="line">    mail.init_app(app)</span><br><span class="line">    moment.init_app(app)</span><br><span class="line">    login_manager.init_app(app)</span><br><span class="line">    login_manager.login_view = &apos;user.login&apos;</span><br><span class="line">    login_manager.login_message = &apos;请登录后再访问&apos;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/06/05/flask配置套路/" data-id="cjil2pq7t0001d4qxjivnffoh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2018-06-04" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/06/04/2018-06-04/" class="article-date">
  <time datetime="2018-06-04T07:27:17.908Z" itemprop="datePublished">2018-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前置知识：</p>
<p>python:</p>
<p>​    装饰器（重点）</p>
<p>​    迭代</p>
<p>​    设计模式：开心的编程思想</p>
<p>Js:</p>
<p>​      Dom对象操作</p>
<p>​      元素的获取，设置</p>
<p>Jquery:</p>
<p>​        工作中常用的前端框架</p>
<p>Bootstrap:</p>
<p>​       常用的前端框架</p>
<p>数据库：</p>
<p>​         关系型：</p>
<p>​                    事务</p>
<p>​         非关系型：</p>
<p>​                    没有事务</p>
<p>​         crud</p>
<p>​         表设计</p>
<p>linux：</p>
<p>​        掌握基本的系统管理</p>
<p>DJango课程：</p>
<p>web是基于http协议请求资源，http是基于tcp协议，http短连接协议</p>
<p>环境配置安装：</p>
<p>​     安装python3环境：</p>
<p>​                           apt-get install python3</p>
<p>​    安装pip:</p>
<p>​                           apt-get install python-pip</p>
<p>​     虚拟环境支持：</p>
<p>​                  apt-get install python3-venv</p>
<p>   安装mysql数据库：</p>
<p>​                apt-get install mysql-server</p>
<p>  安装openssh-server</p>
<p>​              apt-get install openssh-server</p>
<p>数据库配置：</p>
<p>​      </p>
<p>ubuntu下的修改路径/etc/mysql/mysql.conf.d/mysqld.cnf</p>
<p>​     vim /etc/mysql/mysql.conf.d/mysqld.cnf</p>
<p><strong>一、修改/etc/mysql/mysql.conf.d/mysqld.cnf</strong><br>找到bind-address = 127.0.0.1这一行<br>改为bind-address = 0.0.0.0即可</p>
<p><strong>二、为需要远程登录的用户赋予权限</strong></p>
<p>登录mysql数据库：mysql -uroot -p</p>
<p>​                                 输入密码</p>
<p>1、新建用户远程连接mysql数据库<br>grant all on <em>.</em> to admin@’%’ identified by ‘123456’ with grant option;<br>flush privileges;<br>允许任何ip地址(%表示允许任何ip地址)的电脑用admin帐户和密码(123456)来访问这个mysql server。<br>注意admin账户不一定要存在。</p>
<p>2、支持root用户允许远程连接mysql数据库<br>grant all privileges on <em>.</em> to ‘root‘@’%’ identified by ‘123456’ with grant option;<br>flush privileges;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/06/04/2018-06-04/" data-id="cjhzxrqtt0000ooqxzlpsvt1z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-jquery_3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/05/21/jquery_3/" class="article-date">
  <time datetime="2018-05-21T01:28:03.351Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="jquery-3"><a href="#jquery-3" class="headerlink" title="jquery_3"></a>jquery_3</h1><h1 id="一-each方法"><a href="#一-each方法" class="headerlink" title="一.each方法"></a>一.each方法</h1><p>主要功能：遍历jQuery对象</p>
<p>基本语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jQuery对象.each(callback);</span><br><span class="line"></span><br><span class="line">参数说明：</span><br><span class="line"></span><br><span class="line">each方法非常简单，只有一个参数callback，其是一个函数，结构如下：</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">i,item</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//Javascript代码</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i：每次遍历时，系统会自动将循环下标放入变量i中</span><br><span class="line"></span><br><span class="line">item ：每次遍历时，系统会自动将遍历得到的值（dom对象）放入item选项中，</span><br><span class="line"></span><br><span class="line">jQuery对象本质是一个DOM对象集合的数据，所以遍历时每个遍历对象都是一个DOM对象，所以item也是一个DOM对象，如果想使用jQuery中属性或方法，需要通过$符号进行封装。</span><br></pre></td></tr></table></figure>
<h2 id="课堂案例-循环给img添加属性样式"><a href="#课堂案例-循环给img添加属性样式" class="headerlink" title="课堂案例:循环给img添加属性样式"></a>课堂案例:循环给img添加属性样式</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">			$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			                $(<span class="string">"img"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">			                        $(item).attr(<span class="string">'src'</span>,<span class="string">'images/image_'</span>+(i+<span class="number">1</span>)+<span class="string">'.jpg'</span>);</span></span><br><span class="line"><span class="javascript">			                        $(item).css(<span class="string">'width'</span>,<span class="string">'300px'</span>);</span></span><br><span class="line"><span class="undefined">			                &#125;);</span></span><br><span class="line"><span class="undefined">			        &#125;);    </span></span><br><span class="line"><span class="undefined">			&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"给img赋值"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="一、ajax的简介"><a href="#一、ajax的简介" class="headerlink" title="一、ajax的简介"></a>一、ajax的简介</h1><h2 id="1、什么是ajax"><a href="#1、什么是ajax" class="headerlink" title="1、什么是ajax"></a>1、什么是ajax</h2><blockquote>
<p>Asynchronous ：异步</p>
</blockquote>
<blockquote>
<p>JavaScript ：Javascript技术</p>
</blockquote>
<blockquote>
<p>And ：和</p>
</blockquote>
<blockquote>
<p>XML ：xml</p>
</blockquote>
<p>是一种在页面没有刷新的情况下，通过客户端（浏览器）与服务器交互的一种技术。</p>
<p>ajax语言的载体是javascript,最大特点,页面不刷新完成请求。</p>
<h5 id="比如说豆瓣网的电影内容加载"><a href="#比如说豆瓣网的电影内容加载" class="headerlink" title="比如说豆瓣网的电影内容加载"></a>比如说豆瓣网的电影内容加载</h5><p> <img src="/blog/2018/05/21/jquery_3/image_1.png" alt="image_1"></p>
<h2 id="2、ajax的起源"><a href="#2、ajax的起源" class="headerlink" title="2、ajax的起源"></a>2、ajax的起源</h2><p>1998年微软IE5.5浏览器中应用此技术（Outlook小组研发），当时名称为“XMLHTTP”</p>
<p>2005年Google公司真正把Ajax技术应用在Web网页中（Google Map、Google Gmail） </p>
<p>从此由于ajax的出现，javascript语言被重视。</p>
<h3 id="3、原生JS的ajax写法"><a href="#3、原生JS的ajax写法" class="headerlink" title="3、原生JS的ajax写法"></a>3、原生JS的ajax写法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">基于IE内核的浏览器（IE8以下版本） </span><br><span class="line">var  xhr = new ActiveXObject(‘Microsoft.XMLHTTP’);</span><br><span class="line">基于W3C内核的浏览器（IE8以上内核,以及谷歌,火狐,等）</span><br><span class="line">var  xhr = new XMLHttpRequest();</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="built_in">window</span>.onload=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> obtn = <span class="built_in">document</span>.getElementById(<span class="string">'one'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//给按钮绑定事件，向服务器端请求数据</span></span></span><br><span class="line"><span class="javascript">        obtn.onclick=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//具体的请求步骤</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//(1)创建一个ajax对象，</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">                <span class="comment">//(2)设置监听事件，处理回调函数</span></span></span><br><span class="line"><span class="javascript">                xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="comment">//(5)完成请求后的处理</span></span></span><br><span class="line"><span class="javascript">                         <span class="keyword">if</span>(xhr.readyState==<span class="number">4</span>)&#123;</span></span><br><span class="line"><span class="javascript">                                <span class="keyword">var</span> res = xhr.responseText;<span class="comment">//返回的数据结果</span></span></span><br><span class="line"><span class="javascript">                                <span class="built_in">console</span>.log(res);</span></span><br><span class="line"><span class="undefined">                         &#125;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//(3)创建一个http的请求</span></span></span><br><span class="line"><span class="javascript">                xhr.open(<span class="string">'get'</span>,<span class="string">'demo1.php'</span>);</span></span><br><span class="line"><span class="javascript">                <span class="comment">//(4)发送请求</span></span></span><br><span class="line"><span class="javascript">                xhr.send(<span class="literal">null</span>);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取数据服务器端的数据"</span> <span class="attr">id</span>=<span class="string">"one"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="demo1-php"><a href="#demo1-php" class="headerlink" title="demo1.php"></a>demo1.php</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	</span><br><span class="line">	$arr = [</span><br><span class="line">		[<span class="string">'name'</span>=&gt;<span class="string">'tom'</span>,<span class="string">'age'</span>=&gt;<span class="number">18</span>,<span class="string">'sex'</span>=&gt;<span class="string">'male'</span>],</span><br><span class="line">		[<span class="string">'name'</span>=&gt;<span class="string">'jack'</span>,<span class="string">'age'</span>=&gt;<span class="number">19</span>,<span class="string">'sex'</span>=&gt;<span class="string">'male'</span>],</span><br><span class="line">		[<span class="string">'name'</span>=&gt;<span class="string">'berry'</span>,<span class="string">'age'</span>=&gt;<span class="number">20</span>,<span class="string">'sex'</span>=&gt;<span class="string">'female'</span>],</span><br><span class="line">	];</span><br><span class="line">	<span class="keyword">echo</span> json_encode($arr);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="二、Jquery中的Ajax"><a href="#二、Jquery中的Ajax" class="headerlink" title="二、Jquery中的Ajax"></a>二、Jquery中的Ajax</h1><h2 id="1、Jquery中的Ajax引用"><a href="#1、Jquery中的Ajax引用" class="headerlink" title="1、Jquery中的Ajax引用"></a>1、Jquery中的Ajax引用</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1）Ajax的底层实现</span><br><span class="line">jQuery.ajax(options) </span><br><span class="line">$.ajax(); </span><br><span class="line">2）Ajax的高级实现</span><br><span class="line">jQuery.get(url,[data],[callback]) </span><br><span class="line">jQuery.post(url,[data],[callback])</span><br></pre></td></tr></table></figure>
<h3 id="2、Ajax的底层实现"><a href="#2、Ajax的底层实现" class="headerlink" title="2、Ajax的底层实现"></a>2、Ajax的底层实现</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">基本语法：jQuery.ajax(options)或$.ajax(options) </span><br><span class="line">参数：options是一个json对象。</span><br><span class="line">参数说明：</span><br><span class="line">ajax方法只有一个参数，要求是一个json对象</span><br><span class="line"><span class="keyword">async</span>：是否异步，默认其值为<span class="literal">true</span> </span><br><span class="line">cache ：是否缓存，默认其值为<span class="literal">true</span> </span><br><span class="line">complete ：当Ajax状态码为<span class="number">4</span>时，所触发的回调函数</span><br><span class="line">contentType：请求头信息，如果是post请求，默认是，application/x-www-form-urlencoded </span><br><span class="line">data ：发送Ajax时传递的参数，要求是一个字符串或json格式对象。</span><br><span class="line">dataType：期待的返回值类型，常用的是有text,xml,json，默认为text </span><br><span class="line">success ：当Ajax状态码为<span class="number">4</span>且响应状态码为<span class="number">200</span>时，所触发的回调函数</span><br><span class="line">type：http请求，get与post </span><br><span class="line">url：请求的页面</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//写ajax的请求了</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo2.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//msg是从服务器端请求回来的数据。</span></span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'#res'</span>).html(msg);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">#res&#123;width:300px;height:150px;background:gray;&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取ajax请求数据"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo2-php"><a href="#demo2-php" class="headerlink" title="demo2.php"></a>demo2.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  	<span class="keyword">echo</span> <span class="string">"大吉大利,今晚吃鸡!"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="课堂案例：使用-ajax计算两个数的和get和post请求"><a href="#课堂案例：使用-ajax计算两个数的和get和post请求" class="headerlink" title="课堂案例：使用$.ajax计算两个数的和get和post请求"></a>课堂案例：使用$.ajax计算两个数的和get和post请求</h2><h3 id="（1）使用get请求；"><a href="#（1）使用get请求；" class="headerlink" title="（1）使用get请求；"></a>（1）使用get请求；</h3><h5 id="方式一：直接在url里面拼接传递的字符串"><a href="#方式一：直接在url里面拼接传递的字符串" class="headerlink" title="方式一：直接在url里面拼接传递的字符串"></a>方式一：直接在url里面拼接传递的字符串</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//获取输入的两个数的值</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num1 = $(<span class="string">'#num1'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num2 = $(<span class="string">'#num2'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="comment">//写ajax的请求了</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//get请求使用方式一，直接在url中拼接字符串。</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo3.php?num1='</span>+num1+<span class="string">'&amp;num2='</span>+num2,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        $(<span class="string">'#res'</span>).html(msg);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        第一个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num1"</span> <span class="attr">id</span>=<span class="string">"num1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        第二个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num2"</span> <span class="attr">id</span>=<span class="string">"num2"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"计算两个数的和"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="方式二：使用data，data是一个字符串的方式。"><a href="#方式二：使用data，data是一个字符串的方式。" class="headerlink" title="方式二：使用data，data是一个字符串的方式。"></a>方式二：使用data，data是一个字符串的方式。</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//获取输入的两个数的值</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num1 = $(<span class="string">'#num1'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num2 = $(<span class="string">'#num2'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="comment">//写ajax的请求了</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//get请求使用方式二，使用data拼接的字符串。</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                  	data:<span class="string">'num1='</span>+num1+<span class="string">'&amp;num2='</span>+num2,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo3.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        $(<span class="string">'#res'</span>).html(msg);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        第一个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num1"</span> <span class="attr">id</span>=<span class="string">"num1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        第二个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num2"</span> <span class="attr">id</span>=<span class="string">"num2"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"计算两个数的和"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="方式三：使用data，data是一个json格式数据。"><a href="#方式三：使用data，data是一个json格式数据。" class="headerlink" title="方式三：使用data，data是一个json格式数据。"></a>方式三：使用data，data是一个json格式数据。</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//获取输入的两个数的值</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num1 = $(<span class="string">'#num1'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num2 = $(<span class="string">'#num2'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="comment">//写ajax的请求了</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//get请求使用方式三，data是一个 json格式的数据。</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="undefined">                    data:&#123;num1:num1,num2:num2&#125;,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo3.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        $(<span class="string">'#res'</span>).html(msg);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        第一个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num1"</span> <span class="attr">id</span>=<span class="string">"num1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        第二个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num2"</span> <span class="attr">id</span>=<span class="string">"num2"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"计算两个数的和"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo3-php"><a href="#demo3-php" class="headerlink" title="demo3.php"></a>demo3.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="keyword">echo</span> $_GET[<span class="string">'num1'</span>] + $_GET[<span class="string">'num2'</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="（2）使用post请求；"><a href="#（2）使用post请求；" class="headerlink" title="（2）使用post请求；"></a>（2）使用post请求；</h3><h5 id="方式一：使用data，data是一个字符串的方式"><a href="#方式一：使用data，data是一个字符串的方式" class="headerlink" title="方式一：使用data，data是一个字符串的方式"></a>方式一：使用data，data是一个字符串的方式</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//获取输入的两个数的值</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num1 = $(<span class="string">'#num1'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num2 = $(<span class="string">'#num2'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="comment">//写ajax的请求了</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//post请求使用方式一，data是一个 字符串格式的数据。</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'post'</span>,</span></span><br><span class="line"><span class="javascript">                    data:<span class="string">'num1='</span>+num1+<span class="string">'&amp;num2='</span>+num2,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo4.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'#res'</span>).html(msg);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        第一个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num1"</span> <span class="attr">id</span>=<span class="string">"num1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        第二个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num2"</span> <span class="attr">id</span>=<span class="string">"num2"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"计算两个数的和"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="方式二：使用data，data是一个json格式数据。"><a href="#方式二：使用data，data是一个json格式数据。" class="headerlink" title="方式二：使用data，data是一个json格式数据。"></a>方式二：使用data，data是一个json格式数据。</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//获取输入的两个数的值</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num1 = $(<span class="string">'#num1'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num2 = $(<span class="string">'#num2'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="comment">//写ajax的请求了</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//post请求使用方式一，data是一个 字符串格式的数据。</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'post'</span>,</span></span><br><span class="line"><span class="undefined">                    data:&#123;num1:num1,num2:num2&#125;,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo4.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'#res'</span>).html(msg);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        第一个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num1"</span> <span class="attr">id</span>=<span class="string">"num1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        第二个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num2"</span> <span class="attr">id</span>=<span class="string">"num2"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"计算两个数的和"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3、解决Ajax中缓存问题"><a href="#3、解决Ajax中缓存问题" class="headerlink" title="3、解决Ajax中缓存问题"></a>3、解决<strong><strong>Ajax</strong></strong>中缓存问题</h2><p>当我们在<code>IE浏览器下使用get</code>时，系统会存在缓存问题，那么在实际项目开发中，如何解决以上问题呢？</p>
<p>在原生JS的ajax中,实在URL后面添加 <code>随机数</code> 或者添加 <code>时间戳</code> 火灾添加<code>If-Modified-Since</code>来解决缓存问题的.</p>
<p>那么在jquery的ajax中我们可以使用<code>cache:false</code>来解决</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//获取输入的两个数的值</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num1 = $(<span class="string">'#num1'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num2 = $(<span class="string">'#num2'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="comment">//写ajax的请求了</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//post请求使用方式一，data是一个 字符串格式的数据。</span></span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                  	cache:<span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                    data:<span class="string">'num1='</span>+num1+<span class="string">'&amp;num2='</span>+num2,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo6.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'#res'</span>).html(msg);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3、XML与JSON"><a href="#3、XML与JSON" class="headerlink" title="3、XML与JSON"></a>3、XML与JSON</h2><h5 id="（1）Ajax中XML处理大批数据"><a href="#（1）Ajax中XML处理大批数据" class="headerlink" title="（1）Ajax中XML处理大批数据"></a>（1）Ajax中XML处理大批数据</h5><p>XML和HTML非常的相似,但是它不是用来做网页结构的,而是一种DTD严格约束型的数据传输格式,在互联网的第三方支付和金融交易中经常使用的一种数据交互格式</p>
<p>目前在互联网中的使用量大约在5%</p>
<p>为什么在金融交易中会使用xml?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为xml可以控制自定义标签中可以输入&apos;值的类型&apos;和&apos;长度&apos;或者其它的约束</span><br></pre></td></tr></table></figure>
<p>返回简单xml数据</p>
<p>例1：通过xml数据返回两个的数四则运算</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//获取输入的两个数的值</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num1 = $(<span class="string">'#num1'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num2 = $(<span class="string">'#num2'</span>).val();</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                    dataType:<span class="string">'xml'</span>,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo4.php?num1='</span>+num1+<span class="string">'&amp;num2='</span>+num2,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                            <span class="comment">//处理xml格式数据</span></span></span><br><span class="line"><span class="javascript">                            <span class="comment">//原生态的方式处理</span></span></span><br><span class="line"><span class="undefined">                            /*var he = msg.getElementsByTagName('he')[0].childNodes[0].nodeValue;</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> cha = msg.getElementsByTagName(<span class="string">'cha'</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue;</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> ji = msg.getElementsByTagName(<span class="string">'ji'</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue;</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> shang = msg.getElementsByTagName(<span class="string">'shang'</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue;*<span class="regexp">/</span></span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> he = $(msg).find(<span class="string">'he'</span>).text();</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> cha = $(msg).find(<span class="string">'cha'</span>).text();</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> ji = $(msg).find(<span class="string">'ji'</span>).text();</span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> shang = $(msg).find(<span class="string">'shang'</span>).text();</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">"#res"</span>).html(he+<span class="string">'-'</span>+cha+<span class="string">'-'</span>+ji+<span class="string">'-'</span>+shang);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);   </span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        第一个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num1"</span> <span class="attr">id</span>=<span class="string">"num1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        第二个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num2"</span> <span class="attr">id</span>=<span class="string">"num2"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"计算两个数结果"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo4-php"><a href="#demo4-php" class="headerlink" title="demo4.php"></a>demo4.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$num1 = $_GET[<span class="string">'num1'</span>];</span><br><span class="line">$num2 = $_GET[<span class="string">'num2'</span>];</span><br><span class="line">$he = $num1+$num2;</span><br><span class="line">$cha = $num1-$num2;</span><br><span class="line">$ji = $num1*$num2;</span><br><span class="line">$shang = $num1/$num2;</span><br><span class="line"><span class="comment">//返回的数据是xml格式</span></span><br><span class="line">$str=<span class="string">&lt;&lt;&lt;XML</span></span><br><span class="line"><span class="string">&lt;root&gt;</span></span><br><span class="line"><span class="string">        &lt;he&gt;<span class="subst">$he</span>&lt;/he&gt;</span></span><br><span class="line"><span class="string">        &lt;cha&gt;<span class="subst">$cha</span>&lt;/cha&gt;</span></span><br><span class="line"><span class="string">        &lt;ji&gt;<span class="subst">$ji</span>&lt;/ji&gt;</span></span><br><span class="line"><span class="string">        &lt;shang&gt;<span class="subst">$shang</span>&lt;/shang&gt;</span></span><br><span class="line"><span class="string">&lt;/root&gt;</span></span><br><span class="line"><span class="string">XML;</span></span><br><span class="line">header(<span class="string">'content-type:text/xml;charset=utf-8'</span>);</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="返回复杂的xml数据"><a href="#返回复杂的xml数据" class="headerlink" title="返回复杂的xml数据"></a>返回复杂的xml数据</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                    dataType:<span class="string">'xml'</span>,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo5.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                          <span class="comment">//返回的是复杂的xml数据。</span></span></span><br><span class="line"><span class="javascript">                          <span class="keyword">var</span> str = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">                           $(msg).find(<span class="string">'book'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                                        str+=$(item).find(<span class="string">'name'</span>).text()+<span class="string">'---'</span>+$(item).find(<span class="string">'price'</span>).text()+<span class="string">'&lt;br/&gt;'</span>;</span></span><br><span class="line"><span class="undefined">                           &#125;);</span></span><br><span class="line"><span class="javascript">                           $(<span class="string">'#res'</span>).html(str);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);   </span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取数据"</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo5-php"><a href="#demo5-php" class="headerlink" title="demo5.php"></a>demo5.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">'content-type:text/xml;charset=utf-8'</span>);</span><br><span class="line">$str=<span class="string">&lt;&lt;&lt;XML</span></span><br><span class="line"><span class="string">&lt;root&gt;</span></span><br><span class="line"><span class="string">        &lt;book&gt;</span></span><br><span class="line"><span class="string">                &lt;name&gt;javascript从入门到放弃&lt;/name&gt;</span></span><br><span class="line"><span class="string">                &lt;price&gt;123.45&lt;/price&gt;</span></span><br><span class="line"><span class="string">        &lt;/book&gt;</span></span><br><span class="line"><span class="string">        &lt;book&gt;</span></span><br><span class="line"><span class="string">                &lt;name&gt;神奇的我&lt;/name&gt;</span></span><br><span class="line"><span class="string">                &lt;price&gt;63.45&lt;/price&gt;</span></span><br><span class="line"><span class="string">        &lt;/book&gt;</span></span><br><span class="line"><span class="string">        &lt;book&gt;</span></span><br><span class="line"><span class="string">                &lt;name&gt;芮栋传&lt;/name&gt;</span></span><br><span class="line"><span class="string">                &lt;price&gt;163.45&lt;/price&gt;</span></span><br><span class="line"><span class="string">        &lt;/book&gt;</span></span><br><span class="line"><span class="string">         &lt;book&gt;</span></span><br><span class="line"><span class="string">                &lt;name&gt;python从入门到放弃&lt;/name&gt;</span></span><br><span class="line"><span class="string">                &lt;price&gt;56.45&lt;/price&gt;</span></span><br><span class="line"><span class="string">        &lt;/book&gt;</span></span><br><span class="line"><span class="string">&lt;/root&gt;</span></span><br><span class="line"><span class="string">XML;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $str;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="（2）Ajax中Json处理大批量数据"><a href="#（2）Ajax中Json处理大批量数据" class="headerlink" title="（2）Ajax中Json处理大批量数据"></a>（2）<strong><strong>Ajax</strong></strong>中<strong><strong>Json</strong></strong>处理大批量数据</h3><p><strong>返回简单的json 格式数据</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//获取输入的两个数的值</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num1 = $(<span class="string">'#num1'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> num2 = $(<span class="string">'#num2'</span>).val();</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                    dataType:<span class="string">'json'</span>,</span></span><br><span class="line"><span class="undefined">                    data:&#123;num1:num1,num2:num2&#125;,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo6.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                           $(<span class="string">'#res'</span>).html(msg.he+<span class="string">'--'</span>+msg.cha+<span class="string">'--'</span>+msg.ji+<span class="string">'--'</span>+msg.shang);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        第一个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num1"</span> <span class="attr">id</span>=<span class="string">"num1"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        第二个数：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"num2"</span> <span class="attr">id</span>=<span class="string">"num2"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"计算两个数结果"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo6-php"><a href="#demo6-php" class="headerlink" title="demo6.php"></a>demo6.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$num1 = $_GET[<span class="string">'num1'</span>];</span><br><span class="line">$num2 = $_GET[<span class="string">'num2'</span>];</span><br><span class="line">$he = $num1+$num2;</span><br><span class="line">$cha = $num1-$num2;</span><br><span class="line">$ji = $num1*$num2;</span><br><span class="line">$shang = $num1/$num2;</span><br><span class="line"><span class="comment">//返回的数据是json格式</span></span><br><span class="line">$arr=<span class="keyword">array</span>(<span class="string">'he'</span>=&gt;$he,<span class="string">'cha'</span>=&gt;$cha,<span class="string">'ji'</span>=&gt;$ji,<span class="string">'shang'</span>=&gt;$shang);</span><br><span class="line"><span class="keyword">echo</span> json_encode($arr);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="返回复杂的json-格式数据"><a href="#返回复杂的json-格式数据" class="headerlink" title="返回复杂的json 格式数据"></a>返回复杂的json 格式数据</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                    type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                    dataType:<span class="string">'json'</span>,</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">'demo7.php'</span>,</span></span><br><span class="line"><span class="javascript">                    success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                            <span class="comment">//处理大批量的json格式数据</span></span></span><br><span class="line"><span class="javascript">                            <span class="keyword">var</span> str = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">                            $(msg).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                                    str+=item.name+<span class="string">'--'</span>+item.age+<span class="string">'---'</span>+item.address+<span class="string">'&lt;br/&gt;'</span>;</span></span><br><span class="line"><span class="undefined">                            &#125;);</span></span><br><span class="line"><span class="javascript">                            $(<span class="string">'#res'</span>).html(str);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取数据"</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo7-php"><a href="#demo7-php" class="headerlink" title="demo7.php"></a>demo7.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$arr = [</span><br><span class="line">	[<span class="string">'name'</span>=&gt;<span class="string">'芮栋'</span>,<span class="string">'age'</span>=&gt;<span class="number">18</span>,<span class="string">'address'</span>=&gt;<span class="string">'中国'</span>],</span><br><span class="line">	[<span class="string">'name'</span>=&gt;<span class="string">'特朗普'</span>,<span class="string">'age'</span>=&gt;<span class="number">78</span>,<span class="string">'address'</span>=&gt;<span class="string">'星条国'</span>],</span><br><span class="line">	[<span class="string">'name'</span>=&gt;<span class="string">'普京'</span>,<span class="string">'age'</span>=&gt;<span class="number">68</span>,<span class="string">'address'</span>=&gt;<span class="string">'俄国'</span>],</span><br><span class="line">	[<span class="string">'name'</span>=&gt;<span class="string">'安倍'</span>,<span class="string">'age'</span>=&gt;<span class="number">58</span>,<span class="string">'address'</span>=&gt;<span class="string">'倭国'</span>]</span><br><span class="line">];</span><br><span class="line"><span class="keyword">echo</span> json_encode($arr);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="6、Ajax的高级实现"><a href="#6、Ajax的高级实现" class="headerlink" title="6、Ajax的高级实现"></a>6、Ajax的高级实现</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$.get(url,[data],[callback],[dataType])：Ajax中的get请求</span><br><span class="line">$.post(url,[data],[callback],[dataType]])：Ajax中的post请求</span><br><span class="line">参数说明：</span><br><span class="line">url：请求的url地址</span><br><span class="line">[data]：要求格式是一个json对象，也可以是字符串，但是建议使用json对象</span><br><span class="line">[callback]：当Ajax状态码为4且响应状态码为200时所触发的回调函数</span><br><span class="line">[dataType]：期待的返回值类型，text,xml,json</span><br></pre></td></tr></table></figure>
<h5 id="（1）-get请求实现"><a href="#（1）-get请求实现" class="headerlink" title="（1）$.get请求实现"></a>（1）$.get请求实现</h5><p>$.get(url,[data],[callback],[dataType])：Ajax中的get请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> name = $(<span class="string">'input[name=name]'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> pwd = $(<span class="string">'input[name=pwd]'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> data = &#123;<span class="attr">username</span>:name,<span class="attr">password</span>:pwd&#125;;</span></span><br><span class="line"><span class="javascript">                $.get(<span class="string">'demo8.php'</span>,data,<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo8-php"><a href="#demo8-php" class="headerlink" title="demo8.php"></a>demo8.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">print_r($_GET);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="（2）post请求"><a href="#（2）post请求" class="headerlink" title="（2）post请求"></a>（2）post请求</h5><p>$.post(url,[data],[callback],[dataType]])：Ajax中的post请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> name = $(<span class="string">'input[name=name]'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> pwd = $(<span class="string">'input[name=pwd]'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> data = &#123;<span class="attr">username</span>:name,<span class="attr">password</span>:pwd&#125;;</span></span><br><span class="line"><span class="javascript">                $.post(<span class="string">'demo9.php'</span>,data,<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"pwd"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo9-php"><a href="#demo9-php" class="headerlink" title="demo9.php"></a>demo9.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">print_r($_POST);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="三、Ajax中的跨域请求"><a href="#三、Ajax中的跨域请求" class="headerlink" title="三、Ajax中的跨域请求"></a>三、Ajax中的跨域请求</h1><h2 id="1、提出问题"><a href="#1、提出问题" class="headerlink" title="1、提出问题"></a>1、提出问题</h2><h5 id="Ajax跨域请求"><a href="#Ajax跨域请求" class="headerlink" title="Ajax跨域请求:"></a>Ajax跨域请求:</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"input[type=button]"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> name = $(<span class="string">'input[name=name]'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> age = $(<span class="string">'input[name=age]'</span>).val();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> data = &#123;<span class="attr">name</span>:name,<span class="attr">age</span>:age&#125;;</span></span><br><span class="line"><span class="javascript">                $.post(<span class="string">'http://www.hal.com/demo9.php'</span>,data,<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(msg);</span></span><br><span class="line"><span class="undefined">                &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);    </span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"age"</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"提交"</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2new_file.html?__hbt=1522250043273:1 Failed to load http://www.hal.com/demo8.php: No &apos;Access-Control-Allow-Origin&apos; header is present on the requested resource. Origin &apos;http://127.0.0.1:8020&apos; is therefore not allowed access.</span><br><span class="line"></span><br><span class="line">//跨域请求被阻止</span><br></pre></td></tr></table></figure>
<h2 id="2、跨域请求详解"><a href="#2、跨域请求详解" class="headerlink" title="2、跨域请求详解"></a>2、跨域请求详解</h2><p>为什么Ajax不允许跨域请求：受到浏览器中的<strong>同源策略</strong>影响，基于<strong>安全考虑</strong>，不允许跨域</p>
<p>Ajax技术由于受到浏览器的限制，该方法不允许跨域通信。</p>
<p>同源策略阻止从一个域上加载的脚本获取或操作另一个域上的文档属性。也就是说，受到请求的URL 的域必须与当前Web 页面的域相同。这意味着浏览器隔离来自不同源的内容，以防止它们之间的操作。 </p>
<p>面试题：为什么Ajax不允许跨域请求</p>
<p>答：受到浏览器中的同源策略影响，基于安全考虑，不允许跨域</p>
<h2 id="3、通过Jsonp解决跨域请求"><a href="#3、通过Jsonp解决跨域请求" class="headerlink" title="3、通过Jsonp解决跨域请求"></a>3、通过Jsonp解决跨域请求</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">（1）json与jsonp技术区别？</span><br><span class="line">json：一组无序数据的集合，主要实现数据的传输与存储，是一种通用的数据传输格式。</span><br><span class="line">jsonp是一种非官方协议，主要用于解决Ajax跨域请求问题。</span><br><span class="line"></span><br><span class="line">（2）什么是jsonp </span><br><span class="line">JSONP是一个非官方的协议，它允许在服务器端集成script tags返回至客户端，通过javascript callback的形式实现跨域访问。</span><br></pre></td></tr></table></figure>
<h2 id="7、jQuery中解决跨域问题的三种方法"><a href="#7、jQuery中解决跨域问题的三种方法" class="headerlink" title="7、jQuery中解决跨域问题的三种方法"></a>7、jQuery中解决跨域问题的三种方法</h2><blockquote>
<p>$.ajax</p>
</blockquote>
<blockquote>
<p>$.get</p>
</blockquote>
<blockquote>
<p>$.getJSON</p>
</blockquote>
<h5 id="注：以上方法都是使用get请求解决跨域问题"><a href="#注：以上方法都是使用get请求解决跨域问题" class="headerlink" title="注：以上方法都是使用get请求解决跨域问题"></a>注：以上方法都是使用get请求解决跨域问题</h5><h3 id="（1）通过-ajax解决跨域问题"><a href="#（1）通过-ajax解决跨域问题" class="headerlink" title="（1）通过$.ajax解决跨域问题"></a>（1）通过$.ajax解决跨域问题</h3><p>主要是添加两个选项：</p>
<p>一个是：dataType:jsonp’(指定数据传输的类型)   和   jsonp:’fn’（指定回调函数的参数，与后端文件里面介绍函数的参数的名称一致即可）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#btn'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                            type:<span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">                            dataType:<span class="string">'jsonp'</span>,</span></span><br><span class="line"><span class="javascript">                            jsonp:<span class="string">'fn'</span>,</span></span><br><span class="line"><span class="javascript">                            url:<span class="string">'http://www.hal.com/demo11.php'</span>,</span></span><br><span class="line"><span class="javascript">                            success:<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                                        <span class="keyword">var</span> str = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">                                        $(msg).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                                                str+=item.name+<span class="string">'--'</span>+item.age+<span class="string">'--'</span>+item.aihao+<span class="string">'&lt;br/&gt;'</span>;</span></span><br><span class="line"><span class="undefined">                                        &#125;);</span></span><br><span class="line"><span class="javascript">                                        $(<span class="string">'#res'</span>).html(str);</span></span><br><span class="line"><span class="undefined">                            &#125;</span></span><br><span class="line"><span class="undefined">                    &#125;);</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取数据"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="demo11-php"><a href="#demo11-php" class="headerlink" title="demo11.php"></a>demo11.php</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$fn = $_GET[<span class="string">'fn'</span>];<span class="comment">//callback</span></span><br><span class="line">$arr = [</span><br><span class="line">	[<span class="string">'name'</span>=&gt;<span class="string">'芮栋'</span>,<span class="string">'age'</span>=&gt;<span class="number">18</span>,<span class="string">'address'</span>=&gt;<span class="string">'中国'</span>],</span><br><span class="line">	[<span class="string">'name'</span>=&gt;<span class="string">'特朗普'</span>,<span class="string">'age'</span>=&gt;<span class="number">78</span>,<span class="string">'address'</span>=&gt;<span class="string">'星条国'</span>],</span><br><span class="line">	[<span class="string">'name'</span>=&gt;<span class="string">'普京'</span>,<span class="string">'age'</span>=&gt;<span class="number">68</span>,<span class="string">'address'</span>=&gt;<span class="string">'俄国'</span>],</span><br><span class="line">	[<span class="string">'name'</span>=&gt;<span class="string">'安倍'</span>,<span class="string">'age'</span>=&gt;<span class="number">58</span>,<span class="string">'address'</span>=&gt;<span class="string">'倭国'</span>]</span><br><span class="line">];</span><br><span class="line">$json = json_encode($arr);</span><br><span class="line"><span class="keyword">echo</span> $fn.<span class="string">"($json)"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="（2）通过-get方法实现跨域问题"><a href="#（2）通过-get方法实现跨域问题" class="headerlink" title="（2）通过$.get方法实现跨域问题"></a>（2）通过$.get方法实现跨域问题</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">     $(<span class="string">'#btn'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $.get(<span class="string">'http://www.hal.com/demo11.php?fn=?'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">             <span class="keyword">var</span> str = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">             $(msg).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                  str+=item.name+<span class="string">'--'</span>+item.age+<span class="string">'--'</span>+item.aihao+<span class="string">'&lt;br/&gt;'</span>;</span></span><br><span class="line"><span class="undefined">             &#125;);</span></span><br><span class="line"><span class="javascript">             $(<span class="string">'#res'</span>).html(str);</span></span><br><span class="line"><span class="javascript">        &#125;,<span class="string">'jsonp'</span>);</span></span><br><span class="line"><span class="undefined">     &#125;);</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取数据"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="（3）通过-getJSON方法解决跨域问题"><a href="#（3）通过-getJSON方法解决跨域问题" class="headerlink" title="（3）通过$.getJSON方法解决跨域问题"></a>（3）通过$.getJSON方法解决跨域问题</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">'#btn'</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $.getJSON(<span class="string">'http://www.hal.com/demo11.php?fn=?'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                 <span class="keyword">var</span> str = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">                 $(msg).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,item</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                      str+=item.name+<span class="string">'--'</span>+item.age+<span class="string">'--'</span>+item.aihao+<span class="string">'&lt;br/&gt;'</span>;</span></span><br><span class="line"><span class="undefined">                 &#125;);</span></span><br><span class="line"><span class="javascript">                 $(<span class="string">'#res'</span>).html(str);</span></span><br><span class="line"><span class="undefined">            &#125;)</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"获取数据"</span> <span class="attr">id</span>=<span class="string">"btn"</span>/&gt;</span><span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"res"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-最通用也是最好的方法"><a href="#4-最通用也是最好的方法" class="headerlink" title="(4)最通用也是最好的方法"></a>(4)最通用也是最好的方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx允许跨域</span><br><span class="line">apache允许跨域</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/05/21/jquery_3/" data-id="cjhzxrqtt0001ooqxisxow09w" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-pymysql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/05/21/pymysql/" class="article-date">
  <time datetime="2018-05-21T01:06:29.714Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="python使用pymysql"><a href="#python使用pymysql" class="headerlink" title="python使用pymysql"></a>python使用pymysql</h2><p><strong>一、安装</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pymysql</span><br></pre></td></tr></table></figure>
<p><strong>二、使用操作</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">  </span><br><span class="line"><span class="comment"># 创建连接</span></span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">'123456'</span>, db=<span class="string">'python'</span>, charset=<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建游标</span></span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">cursor中还没有数据，只有等到fetchone()或fetchall()的时候才返回一个元组tuple，才支持len()和index()操作，这也是它是迭代器的原因。但同时为什么说它是生成器呢？因为cursor只能用一次，即每用完一次之后记录其位置，等到下次再取的时候是从游标处再取而不是从头再来，而且fetch完所有的数据之后，这个cursor将不再有使用价值了，即不再能fetch到数据了。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">mysql的游标详细看:https://blog.csdn.net/xushouwei/article/details/<span class="number">52201360</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行SQL，并返回受影响行数</span></span><br><span class="line">effect_row = cursor.execute(<span class="string">"select * from stuinfo"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行SQL，并返回受影响行数</span></span><br><span class="line"><span class="comment">#effect_row = cursor.execute("update tb7 set pass = '123' where nid = %s", (11,))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行SQL，并返回受影响行数,执行多次</span></span><br><span class="line"><span class="comment">#effect_row = cursor.executemany("insert into tb7(user,pass,licnese)values(%s,%s,%s)", [("u1","u1pass","11111"),("u2","u2pass","22222")])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交，不然无法保存新建或者修改的数据</span></span><br><span class="line"><span class="comment">#conn.commit()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭游标</span></span><br><span class="line">cursor.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭连接</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p><strong>获取查询数据</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"> </span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">''</span>, db=<span class="string">'tkq1'</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">cursor.execute(<span class="string">"select * from tb7"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#将游标的数据返回类型设置为字典</span></span><br><span class="line">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取结果的第一行数据</span></span><br><span class="line">row_1 = cursor.fetchone()</span><br><span class="line">print(row_1)</span><br><span class="line"><span class="comment"># 获取剩余结果前n行数据</span></span><br><span class="line"><span class="comment"># row_2 = cursor.fetchmany(3)</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 获取剩余结果所有数据</span></span><br><span class="line"><span class="comment"># row_3 = cursor.fetchall()</span></span><br><span class="line"> </span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p><strong>获取新创建数据自增ID</strong></p>
<p>可以获取到最新自增的ID，也就是最后插入的一条数据ID</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"> </span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">''</span>, db=<span class="string">'tkq1'</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line">effect_row = cursor.executemany(<span class="string">"insert into tb7(user,pass,licnese)values(%s,%s,%s)"</span>, [(<span class="string">"u3"</span>,<span class="string">"u3pass"</span>,<span class="string">"11113"</span>),(<span class="string">"u4"</span>,<span class="string">"u4pass"</span>,<span class="string">"22224"</span>)])</span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br><span class="line"><span class="comment">#获取自增id</span></span><br><span class="line">new_id = cursor.lastrowid      </span><br><span class="line"><span class="keyword">print</span> new_id</span><br></pre></td></tr></table></figure>
<p><strong>4、移动游标</strong></p>
<p>操作都是靠游标，那对游标的控制也是必须的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">注：在fetch数据时按照顺序进行，可以使用cursor.scroll(num,mode)来移动游标位置，如：</span><br><span class="line"> </span><br><span class="line">cursor.scroll(<span class="number">1</span>,mode=<span class="string">'relative'</span>) <span class="comment"># 相对当前位置移动</span></span><br><span class="line">cursor.scroll(<span class="number">2</span>,mode=<span class="string">'absolute'</span>) <span class="comment"># 相对绝对位置移动</span></span><br></pre></td></tr></table></figure>
<p><strong>5、fetch数据类型</strong></p>
<p>关于默认获取的数据是元祖类型，如果想要或者字典类型的数据，即：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"> </span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">''</span>, db=<span class="string">'tkq1'</span>)</span><br><span class="line"><span class="comment">#游标设置为字典类型</span></span><br><span class="line">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line">cursor.execute(<span class="string">"select * from tb7"</span>)</span><br><span class="line"> </span><br><span class="line">row_1 = cursor.fetchone()</span><br><span class="line"><span class="keyword">print</span> row_1　　<span class="comment">#&#123;u'licnese': 213, u'user': '123', u'nid': 10, u'pass': '213'&#125;</span></span><br><span class="line"> </span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p><strong>6、调用存储过程</strong></p>
<p>a、调用无参存储过程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> pymysql</span><br><span class="line"> </span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">''</span>, db=<span class="string">'tkq1'</span>)</span><br><span class="line"><span class="comment">#游标设置为字典类型</span></span><br><span class="line">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line"><span class="comment">#无参数存储过程</span></span><br><span class="line">cursor.callproc(<span class="string">'p2'</span>)  <span class="comment">#等价于cursor.execute("call p2()")</span></span><br><span class="line"> </span><br><span class="line">row_1 = cursor.fetchone()</span><br><span class="line"><span class="keyword">print</span> row_1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>b、调用有参存储过程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"> </span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">''</span>, db=<span class="string">'tkq1'</span>)</span><br><span class="line">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line"> </span><br><span class="line">cursor.callproc(<span class="string">'p1'</span>, args=(<span class="number">1</span>, <span class="number">22</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line"><span class="comment">#获取执行完存储的参数,参数@开头</span></span><br><span class="line">cursor.execute(<span class="string">"select @p1,@_p1_1,@_p1_2,@_p1_3"</span>)  <span class="comment">#&#123;u'@_p1_1': 22, u'@p1': None, u'@_p1_2': 103, u'@_p1_3': 24&#125;</span></span><br><span class="line">row_1 = cursor.fetchone()</span><br><span class="line"><span class="keyword">print</span> row_1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p><strong>三、关于pymysql防注入</strong></p>
<p>2、字符串拼接查询，造成注入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"> </span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">''</span>, db=<span class="string">'tkq1'</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"> </span><br><span class="line">user=<span class="string">"abc' or '1'-- "</span></span><br><span class="line">passwd=<span class="string">"u1pass"</span></span><br><span class="line">sql=<span class="string">"select user,pass from tb7 where user='%s' and pass='%s'"</span> % (user,passwd)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#拼接语句被构造成下面这样，永真条件，此时就注入成功了。因此要避免这种情况需使用pymysql提供的参数化查询。</span></span><br><span class="line"><span class="comment">#select user,pass from tb7 where user='u1' or '1'-- ' and pass='u1pass'</span></span><br><span class="line"> </span><br><span class="line">row_count=cursor.execute(sql)</span><br><span class="line">row_1 = cursor.fetchone()</span><br><span class="line"><span class="keyword">print</span> row_count,row_1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
<p>2、避免注入，使用pymysql提供的参数化语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment"># __author__ = "TKQ"</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"> </span><br><span class="line">conn = pymysql.connect(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">3306</span>, user=<span class="string">'root'</span>, passwd=<span class="string">''</span>, db=<span class="string">'tkq1'</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"> </span><br><span class="line">user=<span class="string">"u1' or '1'-- "</span></span><br><span class="line">passwd=<span class="string">"u1pass"</span></span><br><span class="line"><span class="comment">#执行参数化查询</span></span><br><span class="line">row_count=cursor.execute(<span class="string">"select user,pass from tb7 where user=%s and pass=%s"</span>,(user,passwd))</span><br><span class="line"><span class="comment">#内部执行参数化生成的SQL语句，对特殊字符进行了加\转义，避免注入语句生成。</span></span><br><span class="line"><span class="comment"># sql=cursor.mogrify("select user,pass from tb7 where user=%s and pass=%s",(user,passwd))</span></span><br><span class="line"><span class="comment"># print sql</span></span><br><span class="line"><span class="comment">#select user,pass from tb7 where user='u1\' or \'1\'-- ' and pass='u1pass'被转义的语句。</span></span><br><span class="line"> </span><br><span class="line">row_1 = cursor.fetchone()</span><br><span class="line"><span class="keyword">print</span> row_count,row_1</span><br><span class="line"> </span><br><span class="line">conn.commit()</span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/05/21/pymysql/" data-id="cjhfjx3di0004w4qxdm5y0jva" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Mysql主从复制" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/05/21/Mysql主从复制/" class="article-date">
  <time datetime="2018-05-21T01:06:29.632Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Mysql主从实验"><a href="#Mysql主从实验" class="headerlink" title="Mysql主从实验"></a>Mysql主从实验</h1><h2 id="主从的概念"><a href="#主从的概念" class="headerlink" title="主从的概念"></a>主从的概念</h2><h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><ol>
<li><p>关闭selinuxs</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#以下针对两台服务器同时操作</span><br><span class="line">chkconfig selinux off  </span><br><span class="line">#关闭开机启动</span><br><span class="line">setenforce 0    </span><br><span class="line">#关闭selinuxvim /etc/selinux/config </span><br><span class="line">#编辑配置文件</span><br><span class="line">SELINUX=disabled 修改这一行chkconfig iptables off </span><br><span class="line">#关闭防火墙的开机启动</span><br><span class="line">service iptables stop   #关闭防火墙</span><br><span class="line">getenforce  #检测是否关闭</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改主服务器的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure>
<p>修改如下行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]#添加在mysqld模块下</span><br><span class="line">log-bin=mysql-bin   #要开启</span><br><span class="line">server-id=5 #建议改成服务器ip地址的后一位</span><br><span class="line">#master端：</span><br><span class="line">binlog-do-db= python #二进制需要同步的数据库名</span><br><span class="line">binlog-ignore-db=mysql  #避免同步 mysql 用户配置，以免不必要的麻烦</span><br><span class="line">#slave端:</span><br><span class="line">replicate-do-db= python        #(do这个就是直接指定的意思) </span><br><span class="line">replicate-ignore-db=mysql</span><br><span class="line">#重启服务器</span><br><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>
<p>2.数据库结构一致</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">#连接两台服务器的mysql，进行相同的操作。</span><br><span class="line">create database python;</span><br><span class="line">use python;</span><br><span class="line">#master端：</span><br><span class="line">create table user (  </span><br><span class="line">  id int primary key  auto_increment,  </span><br><span class="line">  username varchar(30))engine=innodb;</span><br><span class="line">#slave端:</span><br><span class="line">create table user ( </span><br><span class="line">  id int primary key  auto_increment,</span><br><span class="line">  username varchar(30))engine=myisam;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>​    3.查看主数据库信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#进入mysql </span><br><span class="line">mysql -uroot -p #连接主服务器  </span><br><span class="line">#查看主服务器状态</span><br><span class="line">show master status\G</span><br><span class="line">*************************** 1. row ***************************             File: mysql-bin.000012  #master_log_file=mysql-bin.000012       </span><br><span class="line">Position: 554           #pos master_log_pos= 554      </span><br><span class="line">Binlog_Do_DB: python </span><br><span class="line">Binlog_Ignore_DB: mysql</span><br><span class="line">Executed_Gtid_Set:</span><br></pre></td></tr></table></figure>
<p>4.配置从服务器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p #连接从服务器</span><br><span class="line">#查看监听语句</span><br><span class="line">? change master;</span><br><span class="line">? change</span><br><span class="line">#stop slave 必须是从服务器关闭的状态下</span><br><span class="line">change master to</span><br><span class="line">master_host=&apos;10.11.51.85&apos;,</span><br><span class="line">master_user=&apos;ruidong&apos;,</span><br><span class="line">master_password=&apos;123456&apos;,</span><br><span class="line">master_log_file=&apos;mysql-bin.000012&apos;,  #需要做交换的文件名</span><br><span class="line">master_log_pos=723;</span><br><span class="line"></span><br><span class="line">start slave;    #开启从服务器</span><br><span class="line">show slave status \G;  </span><br><span class="line">#查看状态#==================#当看到</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br><span class="line">#===================</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/05/21/Mysql主从复制/" data-id="cjhfjx3d90001w4qx35yr9ega" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-MySQL第五课" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/05/21/MySQL第五课/" class="article-date">
  <time datetime="2018-05-21T01:06:09.488Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Lesson-5"><a href="#Lesson-5" class="headerlink" title="Lesson_5"></a>Lesson_5</h1><h1 id="MySql-高级"><a href="#MySql-高级" class="headerlink" title="MySql-高级"></a>MySql-高级</h1><h2 id="1-存储过程-procedure"><a href="#1-存储过程-procedure" class="headerlink" title="1.存储过程(procedure)"></a>1.存储过程(procedure)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法:</span><br><span class="line">create procedure 存储过程名(参数,…)</span><br><span class="line">begin</span><br><span class="line">	//代码</span><br><span class="line">end//</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：存储过程中有很多的SQL语句，SQL语句的后面为了保证语法结构必须要有分号（;），但是默认情况下分号表示客户端代码发送到服务器执行。必须更改结束符</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通过delimiter指令来跟结束符</span><br><span class="line"></span><br><span class="line">delimiter // #将结束字符定义为//(原来是;)</span><br></pre></td></tr></table></figure>
<h3 id="1-创建存储过程"><a href="#1-创建存储过程" class="headerlink" title="(1)创建存储过程"></a>(1)创建存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#简单的</span><br><span class="line">create procedure pro_1()</span><br><span class="line">select * from stuinfo;</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#如果存储过程中就一条SQL语句，begin…end两个关键字可以省略。</span><br><span class="line"></span><br><span class="line">#调用存储过程</span><br><span class="line">call pro_1()//</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#包涵多条sql语句的</span><br><span class="line">#in代表输入参数,可以省略</span><br><span class="line">create procedure pro_2(in param int)</span><br><span class="line">begin</span><br><span class="line">	select * from stuinfo where sid=param;</span><br><span class="line">	select * from stumarks where sid=param;</span><br><span class="line">end//</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line">call pro_2(10)//</span><br></pre></td></tr></table></figure>
<h3 id="2-参数的类别"><a href="#2-参数的类别" class="headerlink" title="(2)参数的类别"></a>(2)参数的类别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在存储过程中，没有return，如果需要返回值，通过输出参数来实现</span><br><span class="line">在MySQL中，参数分为3类，输入参数（in），输出参数（out）,输入输出参数（inout），默认情况下是是输入参数（in）</span><br></pre></td></tr></table></figure>
<h3 id="3-删除存储过程"><a href="#3-删除存储过程" class="headerlink" title="(3)删除存储过程"></a>(3)删除存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法:drop procedure [if exists] 存储过程名</span><br><span class="line"></span><br><span class="line">drop procedure if exists pro_1//</span><br></pre></td></tr></table></figure>
<h3 id="4-查看存储过程的信息"><a href="#4-查看存储过程的信息" class="headerlink" title="(4)查看存储过程的信息"></a>(4)查看存储过程的信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show create procedure pro_2\G</span><br></pre></td></tr></table></figure>
<h3 id="5-局部变量"><a href="#5-局部变量" class="headerlink" title="(5)局部变量"></a>(5)局部变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">语法：declare 变量名 数据类型 [初始值]</span><br><span class="line">通过:select ...into…或set命令给变量赋值</span><br><span class="line"></span><br><span class="line">例题通过sid查询姓名和年龄</span><br><span class="line">create procedure pro_3(in id int)</span><br><span class="line">begin</span><br><span class="line">	 declare name varchar(10);</span><br><span class="line">     declare sexx char(10);</span><br><span class="line">     select sname,sex into name,sexx from stuinfo where sid=id;</span><br><span class="line">     select name,sexx from dual;</span><br><span class="line">end //</span><br><span class="line">#调用pro_3</span><br><span class="line">call pro_3(10)//</span><br><span class="line"></span><br><span class="line">#注意:声明的变量名不能和列名(字段名)同名</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">例题:查找同桌</span><br><span class="line">create procedure pro_4(in name varchar(32))</span><br><span class="line">begin</span><br><span class="line">     declare stuseat tinyint;</span><br><span class="line">     select seat into stuseat from stuinfo where sname=name;</span><br><span class="line">     select * from stuinfo where  seat=stuseat+1 or seat=stuseat-1;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line"></span><br><span class="line">call pro_4(&apos;百强&apos;)//</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#通过set给变量赋值</span><br><span class="line"></span><br><span class="line">create procedure pro_5(in num1 year,in num2 year,in name varchar(32))</span><br><span class="line">begin</span><br><span class="line">	declare num int;</span><br><span class="line">	set num=num2-num1; #得到年龄</span><br><span class="line">	update stuinfo set age=num where sname=name;</span><br><span class="line">	select * from stuinfo where sname = name;</span><br><span class="line">end//</span><br><span class="line"></span><br><span class="line">call pro_5(1991,2018,&apos;小力&apos;)//</span><br></pre></td></tr></table></figure>
<h3 id="6-全局变量-用户变量"><a href="#6-全局变量-用户变量" class="headerlink" title="(6)全局变量(用户变量)"></a>(6)全局变量(用户变量)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">全局变量前面必须有一个@，全局变量的数据类型取决于变量的值。如果一个全局变量没有赋值，他的数据类型为null。</span><br><span class="line"></span><br><span class="line">set @name=&apos;百强&apos;//</span><br><span class="line">select * from stuinfo where sname=@name//</span><br></pre></td></tr></table></figure>
<h3 id="7-系统变量"><a href="#7-系统变量" class="headerlink" title="(7)系统变量"></a>(7)系统变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通过两个@开头的都是系统变量</span><br><span class="line"></span><br><span class="line"> select @@version from dual//</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>系统命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>@@version</td>
<td>版本号</td>
</tr>
<tr>
<td>current_date</td>
<td>当前日期</td>
</tr>
<tr>
<td>current_time</td>
<td>当前时间</td>
</tr>
<tr>
<td>current_timestamp</td>
<td>当前日期和时间</td>
</tr>
</tbody>
</table>
<h3 id="8-带有输出参数的存储过程"><a href="#8-带有输出参数的存储过程" class="headerlink" title="(8)带有输出参数的存储过程"></a>(8)带有输出参数的存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#带有out关键字的参数,在存储过程运行结束以后,默认返回</span><br><span class="line">create procedure pro_6(in num int,out result int)</span><br><span class="line">begin</span><br><span class="line">	set result=num*num;</span><br><span class="line">end//</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line">#@result 接受返回值</span><br><span class="line">call pro_6(6,@result)//</span><br><span class="line">select @result from dual//</span><br></pre></td></tr></table></figure>
<h3 id="9-带有输入输出参数的存储过程"><a href="#9-带有输入输出参数的存储过程" class="headerlink" title="(9)带有输入输出参数的存储过程"></a>(9)带有输入输出参数的存储过程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">create procedure pro_7(inout num int)</span><br><span class="line">begin</span><br><span class="line">     set num=num*num;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">#调用</span><br><span class="line"></span><br><span class="line">set @num=10//</span><br><span class="line">call pro_7(@num)//</span><br><span class="line">select @num from dual//</span><br></pre></td></tr></table></figure>
<h2 id="2-SQL编程-了解"><a href="#2-SQL编程-了解" class="headerlink" title="2.SQL编程(了解)"></a>2.SQL编程(了解)</h2><h4 id="1-if-elseif-else语句"><a href="#1-if-elseif-else语句" class="headerlink" title="(1) if-elseif-else语句"></a>(1) if-elseif-else语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#语法:</span><br><span class="line">if 条件 then</span><br><span class="line">	//代码1</span><br><span class="line">elseif 条件 then</span><br><span class="line">	//代码2</span><br><span class="line">else</span><br><span class="line">	//代码3</span><br><span class="line">end if;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create procedure pro_8(in grade int)</span><br><span class="line">begin</span><br><span class="line">     if grade=1 then</span><br><span class="line">        select &apos;金牌会员&apos; as &apos;等级&apos;;</span><br><span class="line">     elseif grade=2 then</span><br><span class="line">        select &apos;普通会员&apos; as &apos;等级&apos;;</span><br><span class="line">     else</span><br><span class="line">         select &apos;游客&apos; as &apos;等级&apos;;</span><br><span class="line">     end if;</span><br><span class="line">end //</span><br><span class="line">#调用</span><br><span class="line">call pro_8(3)//</span><br></pre></td></tr></table></figure>
<h4 id="2-case-when语句"><a href="#2-case-when语句" class="headerlink" title="(2) case-when语句"></a>(2) case-when语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create procedure pro_9(in num int)</span><br><span class="line">begin</span><br><span class="line">     case num</span><br><span class="line">          when 1 then select &apos;杀马特&apos; as &apos;气质&apos;;</span><br><span class="line">          when 2 then select &apos;屌丝&apos; as &apos;气质&apos;;</span><br><span class="line">          when 3 then select &apos;正常人&apos; as &apos;气质&apos;;</span><br><span class="line">          when 4 then select &apos;贵族&apos; as &apos;气质&apos;;</span><br><span class="line">          else select &apos;输入不正确&apos; as &apos;气质&apos;;</span><br><span class="line">     end case;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call pro_9(0)//</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#显示学员的学号、姓名、性别、语文成绩、等级</span><br><span class="line"></span><br><span class="line">select sid,sname,sex,ch,case</span><br><span class="line">       when ch&gt;=90 then &apos;等级A&apos;</span><br><span class="line">       when ch&gt;=80 then &apos;等级B&apos;</span><br><span class="line">       when ch&gt;=70 then &apos;等级C&apos;</span><br><span class="line">       when ch&gt;=60 then &apos;等级D&apos;</span><br><span class="line">       else &apos;等级E&apos;</span><br><span class="line">end as &apos;等级&apos; from stuinfo left join stumarks using(sid)//</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select sid,sname,sex,ch from stuinfo left join stumarks using(sid)//</span><br></pre></td></tr></table></figure>
<h3 id="3-loop循环"><a href="#3-loop循环" class="headerlink" title="(3)loop循环"></a>(3)loop循环</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">loop遇到leave退出</span><br><span class="line">create procedure proc(in num int)</span><br><span class="line">begin</span><br><span class="line">     declare total int default 0;</span><br><span class="line">     declare i int default 0;</span><br><span class="line">     sign:loop</span><br><span class="line">         set total=total+i;</span><br><span class="line">         set i=i+1;</span><br><span class="line">         if i&gt;=num then</span><br><span class="line">            leave sign;# leave=break</span><br><span class="line">         end if;</span><br><span class="line">     end loop;</span><br><span class="line">     select total from dual;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call proc(100)//</span><br><span class="line">#如果没有设置标签名,leave loop</span><br><span class="line">#sign是循环名,用于结束循环,可以自己随意取名字</span><br></pre></td></tr></table></figure>
<h3 id="4-while循环"><a href="#4-while循环" class="headerlink" title="(4)while循环"></a>(4)while循环</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#语法:</span><br><span class="line">while 条件 do</span><br><span class="line">	//代码</span><br><span class="line">end while</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create procedure pro_11(in num int)</span><br><span class="line">begin</span><br><span class="line">     declare total int default 0;</span><br><span class="line">     declare i int default 0;</span><br><span class="line">     while num&gt;=i do</span><br><span class="line">           set total=total+i;</span><br><span class="line">           set i=i+1;</span><br><span class="line">     end while;</span><br><span class="line">     select total from dual;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call pro_11(100)//</span><br></pre></td></tr></table></figure>
<h3 id="5-repeat循环"><a href="#5-repeat循环" class="headerlink" title="(5)repeat循环"></a>(5)repeat循环</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#语法</span><br><span class="line">repeat</span><br><span class="line">	代码</span><br><span class="line">	until 条件    -- 直重复到条件为true才结束</span><br><span class="line">end repeat</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">create procedure pro_12(in num int)</span><br><span class="line">begin</span><br><span class="line">     declare total int default 0;</span><br><span class="line">     declare i int default 0;</span><br><span class="line">     repeat</span><br><span class="line">           set total=total+i;</span><br><span class="line">           set i=i+1;</span><br><span class="line">           until i&gt;num</span><br><span class="line">     end repeat;</span><br><span class="line">     select total from dual;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call pro_12(100)//</span><br></pre></td></tr></table></figure>
<h3 id="6-leave和iterate"><a href="#6-leave和iterate" class="headerlink" title="(6)leave和iterate"></a>(6)leave和iterate</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">leave类似于break，iterate类似于continue</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">create procedure pro_13()</span><br><span class="line">begin</span><br><span class="line">     declare i int default 0;</span><br><span class="line">     sign:while i&lt;5 do</span><br><span class="line">           set i=i+1;</span><br><span class="line">           if(i=3) then</span><br><span class="line">                   leave sign;   -- 类似于break</span><br><span class="line">                   #iterate sign;    -- 类似于continue</span><br><span class="line">           end if;</span><br><span class="line">           select i from dual;</span><br><span class="line">     end while;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">call pro_13()//</span><br></pre></td></tr></table></figure>
<h2 id="3-MySql函数"><a href="#3-MySql函数" class="headerlink" title="3.MySql函数"></a>3.MySql函数</h2><h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><h4 id="1-数字类"><a href="#1-数字类" class="headerlink" title="(1).数字类"></a>(1).数字类</h4><table>
<thead>
<tr>
<th>语句</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>select rand()  from dual;</td>
<td>随机数</td>
</tr>
<tr>
<td>select * from stuinfo order by rand();</td>
<td>随机排序</td>
</tr>
<tr>
<td>select round(5.6);</td>
<td>四舍五入</td>
</tr>
<tr>
<td>select ceil(5.3);</td>
<td>向上取整</td>
</tr>
<tr>
<td>select floor(5.6);</td>
<td>向下取整</td>
</tr>
</tbody>
</table>
<h4 id="2-大小写转换"><a href="#2-大小写转换" class="headerlink" title="(2).大小写转换"></a>(2).大小写转换</h4><table>
<thead>
<tr>
<th>语句</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>select  ucase(‘i am lyb’);</td>
<td>大写</td>
</tr>
<tr>
<td>select lcase(‘I AM LYB’);</td>
<td>小写</td>
</tr>
</tbody>
</table>
<h4 id="3-截取字符串"><a href="#3-截取字符串" class="headerlink" title="(3).截取字符串"></a>(3).截取字符串</h4><table>
<thead>
<tr>
<th>语句</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>select left(‘abcdefg’,3);</td>
<td>截取左边的3位</td>
</tr>
<tr>
<td>select right(‘abcdefg’,3);</td>
<td>截取右边3位</td>
</tr>
<tr>
<td>select substring(‘abcdefg’,2,3);</td>
<td>从第2位开始取3个字符，起始位置从1开始</td>
</tr>
</tbody>
</table>
<h4 id="4-字符串拼接"><a href="#4-字符串拼接" class="headerlink" title="(4).字符串拼接"></a>(4).字符串拼接</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select concat(sid,sname,age,sex,city) from stuinfo;</span><br><span class="line"></span><br><span class="line">mysql&gt; select concat(sid,sname,age,sex,city) from stuinfo;</span><br><span class="line">+--------------------------------+</span><br><span class="line">| concat(sid,sname,age,sex,city) |</span><br><span class="line">+--------------------------------+</span><br><span class="line">| 7小明18male上海                      |</span><br><span class="line">| 8小刚20male北京                       |</span><br><span class="line">| 9小强22male重庆                      |</span><br><span class="line">| 10小力23male天津                      |</span><br><span class="line">| 11小丽21female北京                    |</span><br><span class="line">| 12小月20female天津                    |</span><br><span class="line">| 13小yb18male重庆                    |</span><br><span class="line">| 17百强18male黑龙江                      |</span><br><span class="line">| 18百强118male黑龙江                     |</span><br><span class="line">| 19百强218male黑龙江                     |</span><br><span class="line">+--------------------------------+</span><br></pre></td></tr></table></figure>
<h4 id="5-coalesce-str1-str2-如果str1不为null则显示str1，否则显示str2"><a href="#5-coalesce-str1-str2-如果str1不为null则显示str1，否则显示str2" class="headerlink" title="(5).coalesce(str1,str2):如果str1不为null则显示str1，否则显示str2"></a>(5).coalesce(str1,str2):如果str1不为null则显示str1，否则显示str2</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">select sid,sname,coalesce(ch,&apos;缺考&apos;),coalesce(math,&apos;缺考&apos;) from stuinfo left join stumarks using(sid);</span><br><span class="line"></span><br><span class="line">mysql&gt; select sid,sname,coalesce(ch,&apos;缺考&apos;),coalesce(math,&apos;缺考&apos;) from stuinfo l</span><br><span class="line">eft join stumarks using(sid);</span><br><span class="line">+-----+-------+---------------------+-----------------------+</span><br><span class="line">| sid | sname | coalesce(ch,&apos;缺考&apos;) | coalesce(math,&apos;缺考&apos;) |</span><br><span class="line">+-----+-------+---------------------+-----------------------+</span><br><span class="line">|  11 | 小丽  | 100                 | 80                    |</span><br><span class="line">|   8 | 小刚  | 60                  | 98                    |</span><br><span class="line">|  10 | 小力  | 50                  | 51                    |</span><br><span class="line">|   9 | 小强  | 67                  | 88                    |</span><br><span class="line">|   7 | 小明  | 88                  | 10                    |</span><br><span class="line">|  12 | 小月  | 96                  | 97                    |</span><br><span class="line">|  17 | 百强  | 缺考                | 缺考                   |</span><br><span class="line">|  18 | 百强1 | 缺考                | 缺考                  |</span><br><span class="line">|  19 | 百强2 | 缺考                | 缺考                  |</span><br><span class="line">+-----+-------+---------------------+-----------------------+</span><br></pre></td></tr></table></figure>
<h4 id="6-length-字节长度-、char-length-字符长度-、trim-去两边空格-、repace-替换"><a href="#6-length-字节长度-、char-length-字符长度-、trim-去两边空格-、repace-替换" class="headerlink" title="(6).length(字节长度)、char_length(字符长度)、trim(去两边空格)、repace(替换)"></a>(6).length(字节长度)、char_length(字符长度)、trim(去两边空格)、repace(替换)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select length(&apos;千锋&apos;);</span><br><span class="line"></span><br><span class="line">select char_length(&apos;千锋&apos;);</span><br><span class="line"></span><br><span class="line">select length(trim(&apos; 千锋 &apos;));</span><br><span class="line"></span><br><span class="line">select replace(&apos;pgone&apos;,&apos;one&apos;,&apos;two&apos;);</span><br></pre></td></tr></table></figure>
<h4 id="7-时间戳"><a href="#7-时间戳" class="headerlink" title="(7).时间戳"></a>(7).时间戳</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select unix_timestamp();</span><br></pre></td></tr></table></figure>
<h4 id="8-将时间戳转成当前时间"><a href="#8-将时间戳转成当前时间" class="headerlink" title="(8).将时间戳转成当前时间"></a>(8).将时间戳转成当前时间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select from_unixtime(unix_timestamp());</span><br></pre></td></tr></table></figure>
<h4 id="9-获取当前时间"><a href="#9-获取当前时间" class="headerlink" title="(9).获取当前时间"></a>(9).获取当前时间</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select now(),year(now()),month(now()),day(now()),hour(now()), minute(now()),second(now())\G</span><br><span class="line"></span><br><span class="line">#现在时间,年,月,日,时,分,秒</span><br></pre></td></tr></table></figure>
<h4 id="10-dayname-monthname-dayofyear"><a href="#10-dayname-monthname-dayofyear" class="headerlink" title="(10).dayname(),monthname(),dayofyear()"></a>(10).dayname(),monthname(),dayofyear()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select dayname(now()) as `星期`,monthname(now()) as `月份`,dayofyear(now()) as `本年第几天`;</span><br></pre></td></tr></table></figure>
<h4 id="11-datediff-结束日期，开始日期"><a href="#11-datediff-结束日期，开始日期" class="headerlink" title="(11).datediff(结束日期，开始日期)"></a>(11).datediff(<strong><strong>结束日期</strong></strong>，开始日期)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">例题计算自己活了多少天</span><br><span class="line">select datediff(now(),&apos;1970-1-1&apos;);</span><br></pre></td></tr></table></figure>
<h4 id="12-md5-md5加密"><a href="#12-md5-md5加密" class="headerlink" title="(12).md5():md5加密"></a>(12).md5():md5加密</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select md5(&apos;@123456.&apos;);</span><br></pre></td></tr></table></figure>
<h2 id="3-自定义函数"><a href="#3-自定义函数" class="headerlink" title="3.自定义函数"></a>3.自定义函数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#语法:</span><br><span class="line">Create function 函数名(形参) returns 返回的数据类型</span><br><span class="line">begin</span><br><span class="line">	//函数体</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#第一步</span><br><span class="line">delimiter //</span><br><span class="line"></span><br><span class="line">#不带参数的函数</span><br><span class="line">create function myfun() returns varchar(32)</span><br><span class="line">begin</span><br><span class="line">     return &apos;千锋python&apos;;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">#调用函数</span><br><span class="line">select myfun()//</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#带参数</span><br><span class="line">create function myfun_1(num1 int,num2 int) returns int</span><br><span class="line">begin</span><br><span class="line">     declare num int default 0;</span><br><span class="line">     set num=num1+num2;</span><br><span class="line">     return num;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">select myfun_1(100,200)//</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#删除函数</span><br><span class="line">drop function myfun_1//</span><br></pre></td></tr></table></figure>
<h2 id="4-触发器"><a href="#4-触发器" class="headerlink" title="4.触发器"></a>4.触发器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、触发器是一个特殊的存储过程</span><br><span class="line">2、不需要直接调用，在MySQL自动调用的</span><br><span class="line">3、是一个事务，可以回滚</span><br></pre></td></tr></table></figure>
<h4 id="1-触发器的类型-触发事件"><a href="#1-触发器的类型-触发事件" class="headerlink" title="(1)触发器的类型(触发事件)"></a>(1)触发器的类型(触发事件)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、insert触发器</span><br><span class="line">2、update触发器</span><br><span class="line">3、delete触发器</span><br></pre></td></tr></table></figure>
<h4 id="2-创建触发器"><a href="#2-创建触发器" class="headerlink" title="(2)创建触发器"></a>(2)创建触发器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#语法:</span><br><span class="line">Create trigger 触发器名 触发时间[before|after] 触发事件 on 表名 for each row</span><br><span class="line">Begin</span><br><span class="line">	//代码</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h4 id="3-new表和old表"><a href="#3-new表和old表" class="headerlink" title="(3)new表和old表"></a>(3)new表和old表</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1、这两个表是个临时表</span><br><span class="line">2、当触发器触发的时候在内存中自己创建，触发器执行完毕后自动销毁</span><br><span class="line">3、他们的表结构和触发器触发的表的结构一样</span><br><span class="line">4、只读，不能修改</span><br><span class="line"></span><br><span class="line">stuinfo curd</span><br><span class="line"></span><br><span class="line">打开文件,内存中需要加载,会随即分配一个空间用来保存文件的所有数据,-&gt;old  6</span><br><span class="line"></span><br><span class="line">在新的一轮操作后,内存会生成新的空间,这个空间里面保存了新的数据变化-&gt;new 7</span><br></pre></td></tr></table></figure>
<h4 id="5-insert触发器"><a href="#5-insert触发器" class="headerlink" title="(5)insert触发器"></a>(5)insert触发器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#在stuinfo中插入一个值,就会自动在stumarks中插入一条数据</span><br><span class="line">#after insert 表示的是在insert动作执行完毕以后触发</span><br><span class="line">#on stuinfo for each row  针对的stuinfo表,并且可以读取到每一行的变化</span><br><span class="line">#触发器中定义的局部变量不能与表中的字段名一致,否则会发生字段识别问题(识别不出到底是字段,还是变量)</span><br><span class="line">create trigger trig1</span><br><span class="line">after insert on stuinfo for each row</span><br><span class="line">begin</span><br><span class="line">     declare sidno int default 0;</span><br><span class="line">	 declare nch int default 0;</span><br><span class="line">     declare nmath int default 0;</span><br><span class="line">	 declare nseat int default 0;</span><br><span class="line">     set sidno=new.sid;</span><br><span class="line">	 set nseat=new.seat;</span><br><span class="line">     insert into stumarks set sid=sidno,ch=nch,math=nmath,seat=nseat;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">insert into stuinfo values(null,&apos;随便&apos;,&apos;male&apos;,20,&apos;合肥&apos;,12)//</span><br></pre></td></tr></table></figure>
<h4 id="6-update触发器"><a href="#6-update触发器" class="headerlink" title="(6)update触发器"></a>(6)update触发器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">create trigger trig2</span><br><span class="line">after update on stuinfo for each row</span><br><span class="line">begin</span><br><span class="line">	declare sidno int default 0;</span><br><span class="line">    declare seatno int default 0;</span><br><span class="line">	set seatno=new.seat;</span><br><span class="line">	set sidno =new.sid;</span><br><span class="line">	update stumarks set seat=seatno where sid =sidno;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">select ((select max(seat) from stuinfo)+1)//</span><br><span class="line">update stuinfo set seat=12 where sid=12//</span><br></pre></td></tr></table></figure>
<h4 id="7-delete触发器"><a href="#7-delete触发器" class="headerlink" title="(7)delete触发器"></a>(7)delete触发器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create trigger trig3</span><br><span class="line">after delete on stuinfo for each row</span><br><span class="line">begin</span><br><span class="line">     declare sidno int default 0;</span><br><span class="line">	 set sidno =old.sid; #删除了新表里面就没有了,只能从老表里面拿</span><br><span class="line">	 delete from stumarks where sid=sidno;</span><br><span class="line">end //</span><br><span class="line"></span><br><span class="line">delete from stuinfo where sid =13//</span><br><span class="line"></span><br><span class="line">#触发器能做钩子函数</span><br></pre></td></tr></table></figure>
<h4 id="8-查看-和-删除-触发器"><a href="#8-查看-和-删除-触发器" class="headerlink" title="(8)查看 和 删除 触发器"></a>(8)查看 和 删除 触发器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show triggers\G</span><br><span class="line"></span><br><span class="line">drop trigger if exists trig1//</span><br></pre></td></tr></table></figure>
<h3 id="5-用户管理"><a href="#5-用户管理" class="headerlink" title="##5.用户管理"></a>##5.用户管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqld --skip--grant--tables</span><br><span class="line">#(5.5最好用)</span><br><span class="line">#--skip--grant--tables 跳过登陆验证(MYSQL服务器开起中)</span><br></pre></td></tr></table></figure>
<h3 id="1-创建用户"><a href="#1-创建用户" class="headerlink" title="(1)创建用户"></a>(1)创建用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：create user ‘用户名’@’允许登录的主机地址’  identified by 密码</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#%代表数据库的库名</span><br><span class="line">create user &apos;ruidong&apos;@&apos;%&apos; identified by &apos;123456&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="2-删除用户"><a href="#2-删除用户" class="headerlink" title="(2)删除用户"></a>(2)删除用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法：drop user 用户</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop user ruidong;</span><br></pre></td></tr></table></figure>
<h3 id="3-增加用户权限"><a href="#3-增加用户权限" class="headerlink" title="(3)增加用户权限"></a>(3)增加用户权限</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#将python的所有表的select权限付给ruidong用户</span><br><span class="line">grant select on python.* to &apos;ruidong&apos;@&apos;%&apos;;  </span><br><span class="line"></span><br><span class="line">#将所有数据库中所有表的所有权限付给ruidong用户</span><br><span class="line">grant all privileges on *.* to &apos;ruidong&apos;@&apos;%&apos;;</span><br><span class="line"></span><br><span class="line">#创建用户并授权</span><br><span class="line">grant all privileges on *.* to &apos;hal&apos;@&apos;%&apos; identified by &apos;123456&apos; with grant option;</span><br><span class="line"></span><br><span class="line">#创建好用户以后,刷新mysql用户权限表</span><br><span class="line">flush privileges ;(linux ,mac)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">revoke select on python.* from &apos;ruidong&apos;@&apos;%&apos;;   #删除select权限</span><br><span class="line">revoke all privileges on *.* from &apos;ruidong&apos;@&apos;%&apos;; #删除所有权限</span><br></pre></td></tr></table></figure>
<h3 id="4-mysql57忘记密码"><a href="#4-mysql57忘记密码" class="headerlink" title="(4)mysql57忘记密码"></a>(4)mysql57忘记密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1、首先停止mysql服务进程：</span><br><span class="line">service mysqld stop</span><br><span class="line">2.#然后编辑mysql的配置文件my.cnf(如果是windows的话找到my.ini)</span><br><span class="line">vim /etc/my.cnf</span><br><span class="line">3.#找到 [mysqld]这个模块：</span><br><span class="line">#在最后面添加一段代码</span><br><span class="line">skip-grant-tables   ##忽略mysql权限问题，直接登录</span><br><span class="line">#然后保存 :wq!退出</span><br><span class="line">#启动mysql服务：</span><br><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#直接进入mysql数据库：</span><br><span class="line">mysql</span><br><span class="line">#选择mysql数据库</span><br><span class="line">use mysql;</span><br><span class="line">#对user表的root用户进行密码修改</span><br><span class="line">update mysql.user set authentication_string=password(&apos;123456&apos;) where user=&apos;root&apos; and Host = &apos;localhost&apos;;</span><br><span class="line"></span><br><span class="line">#特别提醒注意的一点是，新版的mysql数据库下的user表中已经没有Password字段了</span><br><span class="line">#而是将加密后的用户密码存储于authentication_string字段</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#执行刷新</span><br><span class="line"> flush privileges;</span><br><span class="line">#exit退出mysql</span><br><span class="line">exit;</span><br><span class="line">#启动服务</span><br><span class="line">service mysqld start</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/05/21/MySQL第五课/" data-id="cjhfjx3d00000w4qx4jb4e7sz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-MySQL第四课" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/05/21/MySQL第四课/" class="article-date">
  <time datetime="2018-05-21T01:05:31.316Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Lesson-4"><a href="#Lesson-4" class="headerlink" title="Lesson_4"></a>Lesson_4</h1><h1 id="MySql"><a href="#MySql" class="headerlink" title="MySql"></a>MySql</h1><h2 id="1-union联合查询"><a href="#1-union联合查询" class="headerlink" title="1.union联合查询"></a>1.union联合查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">将多个select语句的结果纵向组合</span><br><span class="line"></span><br><span class="line">select * from stuinfo union select * from stuinfoo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">union:</span><br><span class="line">1.all #显示全部记录</span><br><span class="line">2.distinct  #(去除重复的值  他是默认)</span><br><span class="line"></span><br><span class="line">select * from stuinfo union all select * from stuinfoo;</span><br></pre></td></tr></table></figure>
<p>查找北京的女生和上海的男生  <code>[晚上自己写一篇或多编]</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from stuinfo where (city=&apos;上海&apos; and sex=&apos;male&apos;) or (city=&apos;北京&apos; and sex=&apos;female&apos;);</span><br><span class="line"></span><br><span class="line">select * from stuinfo having city=&apos;上海&apos; and sex=&apos;male&apos; union all select * from stuinfo having city=&apos;北京&apos; and sex=&apos;female&apos;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Union的要求:</span><br><span class="line">1.两边的select语句的字段数要一致</span><br><span class="line">2,字段名可以不一样,最终按照第一个select语句的字段名返回</span><br><span class="line">3.两边可以具有相同或不同的数据类型</span><br></pre></td></tr></table></figure>
<p>男生的年龄降序,女生的年龄升序    <code>[ 晚上自己写一篇或多编]</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(select * from stuinfo having sex=1 order by age desc limit 1000) union all (select * from stuinfo having sex=2 order by age asc limit 1000);</span><br></pre></td></tr></table></figure>
<h2 id="2-多表查询"><a href="#2-多表查询" class="headerlink" title="2.多表查询"></a>2.多表查询</h2><h3 id="1-分类"><a href="#1-分类" class="headerlink" title="(1)分类"></a>(1)分类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.内连接</span><br><span class="line">2.外连接</span><br><span class="line">	a.左外连接</span><br><span class="line">	b.右外连接</span><br><span class="line">3.交叉连接</span><br><span class="line">4.自然连接</span><br></pre></td></tr></table></figure>
<h3 id="2-内连接-inner-join"><a href="#2-内连接-inner-join" class="headerlink" title="(2)内连接(inner join)"></a>(2)内连接(inner join)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查询学生信息</span><br><span class="line">select * from stuinfo inner join stumarks on stuinfo.sid = stumarks.stuno;</span><br><span class="line">#inner 可以不用写</span><br><span class="line">#给表取别名的 as 也可以省略不写</span><br><span class="line">select * from stuinfo a join stumarks b on a.sid = b.stuno;</span><br><span class="line"></span><br><span class="line">#inner join数据不完整就不显示</span><br><span class="line"></span><br><span class="line">大坑别踩:</span><br><span class="line"></span><br><span class="line">表连接肯定经常要用,如果你查询单条数据,而这条数据的从表信息不完整,使用内链接,查询出的结果为空,</span><br><span class="line">但是,python代码的写法是一致的,为了避免python报错,基本不使用内链接.</span><br></pre></td></tr></table></figure>
<h3 id="3-外连接"><a href="#3-外连接" class="headerlink" title="(3)外连接"></a>(3)外连接</h3><h4 id="a-左外连接-left-join"><a href="#a-左外连接-left-join" class="headerlink" title="a.左外连接(left  join)"></a>a.左外连接(left  join)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from stuinfo a left join stumarks b on a.sid=b.sid;</span><br><span class="line">#以左边的表为准,右边表中没有的记录用null表示</span><br></pre></td></tr></table></figure>
<h4 id="b-右外连接-right-join"><a href="#b-右外连接-right-join" class="headerlink" title="b.右外连接(right join)"></a>b.右外连接(right join)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from stuinfo a right join stumarks b on a.sid=b.sid;</span><br><span class="line">##以右边的表为准,左边表中没有的记录用null表示</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">思考:</span><br><span class="line">select * from 表一 inner join 表二 on 表一.公共字段=表二.公共字段;</span><br><span class="line">select * from 表二 inner join 表一 on 表二.公共字段=表一.公共字段;</span><br><span class="line"></span><br><span class="line">select * from 表一 left join 表二 on 表一.公共字段=表二.公共字段;</span><br><span class="line">select * from 表一 right join 表二 on 表一.公共字段=表二.公共字段;</span><br><span class="line"></span><br><span class="line">select * from 表一 left join 表二 on 表一.公共字段=表二.公共字段;</span><br><span class="line">select * from 表二 right join 表一 on 表二.公共字段=表一.公共字段;</span><br></pre></td></tr></table></figure>
<h3 id="4-交叉连接-cross-join"><a href="#4-交叉连接-cross-join" class="headerlink" title="(4)交叉连接(cross join)"></a>(4)交叉连接(cross join)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#交叉连接返回的结果和内链接一样的</span><br><span class="line">select * from stuinfo a cross join stumarks b on a.sid=b.stuno;</span><br><span class="line">select * from  stuinfo,stumarks;</span><br></pre></td></tr></table></figure>
<h3 id="5-自然连接-natural"><a href="#5-自然连接-natural" class="headerlink" title="(5)自然连接(natural)"></a>(5)自然连接(natural)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.natural join #自然内连接</span><br><span class="line">2.natural left join #自然左外连接</span><br><span class="line">3.natural right join #自然右外连接</span><br><span class="line"></span><br><span class="line">select * from stuinfo a natural join stumarks b;</span><br><span class="line">select * from stuinfo a natural left join stumarks b;</span><br><span class="line">select * from stuinfo a natural right join stumarks b;</span><br><span class="line"></span><br><span class="line">结论:</span><br><span class="line">1.自动判断连接条件,依据的是同名字段名</span><br><span class="line">2.如果没有同名的字段名返回的是笛卡尔积</span><br><span class="line">3.自动返回结果并进行整理;</span><br><span class="line">	a.连接字段最好保留一个</span><br><span class="line">	b.连接字段最好放在最前面</span><br></pre></td></tr></table></figure>
<h3 id="6-using"><a href="#6-using" class="headerlink" title="(6)using"></a>(6)using</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#指定连接字段,using也会查询出的结果进行整理,整理的方式和自然连接相同.</span><br><span class="line"></span><br><span class="line">select * from stuinfo left join stumarks using(sid);</span><br></pre></td></tr></table></figure>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.显示地区和每个地区参加数学考试的人数,并且按人数降序排列</span><br><span class="line">select a.city,count(b.math)  c from stuinfo a left join stumarks b using(sid) group by city order by c desc;</span><br><span class="line"></span><br><span class="line">2..显示男生人数和女生人数</span><br><span class="line">select a.sex,count(a.sex) from stuinfo a group by sex;</span><br><span class="line"></span><br><span class="line">select sex,count(sex) from stuinfo where sex=1 union select sex,count(sex) from stuinfo where sex=2;</span><br><span class="line"></span><br><span class="line">select sum(sex=1) 男,sum(sex=2) 女 from stuinfo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3.显示每个地区的男生人数,女生人数,总人数</span><br><span class="line">select city 城市,count(sex) 总人数,sum(sex=&apos;male&apos;) 男, sum(sex=&apos;female&apos;) 女 from stuinfo group by city;</span><br></pre></td></tr></table></figure>
<h2 id="3-子查询"><a href="#3-子查询" class="headerlink" title="3.子查询"></a>3.子查询</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">什么叫子查询?</span><br><span class="line">查询语句中还有查询语句,外面的查询称为父查询,里面的叫子查询.</span><br><span class="line">子查询为父查询提供查询条件.</span><br><span class="line"></span><br><span class="line">例题:查询数学成绩是80分的学生</span><br><span class="line">#普通的查询</span><br><span class="line">select * from stumarks left join stuinfo using(sid) where math=80;</span><br><span class="line">#子查询</span><br><span class="line">select * from stuinfo where sid=(select sid from stumarks where math = 80);</span><br><span class="line">#如果使用等于,那就必须确保子查询查到的结果只有一个</span><br><span class="line">#子查询的结果只能是单一的字段</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">例题:查找数学最高分的学生</span><br><span class="line">#普通的查询</span><br><span class="line">select a.sid,a.sname,a.sex,a.age,a.city,max(b.math) from stuinfo a left join stumarks b using(sid);#问题 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#子查询</span><br><span class="line">select * from  stuinfo where sid = (select sid from stumarks where math = (select max(math) from stumarks));</span><br></pre></td></tr></table></figure>
<h3 id="1-in-not-in"><a href="#1-in-not-in" class="headerlink" title="(1)in|not in"></a>(1)in|not in</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">如果子查询中返回了多条记录,使用 = 会发生错误,那么就必须要用in</span><br><span class="line"></span><br><span class="line">例题:查询数学成绩不及格的学生</span><br><span class="line"> select * from stuinfo where sid in (select sid from stumarks where math in (select math from stumarks having math&lt;60));</span><br><span class="line"></span><br><span class="line">#1.数学成绩不及格 &lt;60 60种可能</span><br><span class="line">select math from stumarks having math&lt;60; #查询到的有可能是一个也有可能是多个(58,59)</span><br><span class="line">#2.这些成绩是那些学生的(sid)</span><br><span class="line">select sid from stumarks where math in (58,59);   #(3,4)</span><br><span class="line">#3.根据学号查找学生的信息</span><br><span class="line"> select * from stuinfo where sid in (3,4);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">例题:查询没有参加考试的学生</span><br><span class="line">select * from stuinfo where sid in (select sid from stumarks where math is null);</span><br></pre></td></tr></table></figure>
<h3 id="2-some-any-all"><a href="#2-some-any-all" class="headerlink" title="(2)some | any|all"></a>(2)some | any|all</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">some和any是一样的,表示一些,类似与 in</span><br><span class="line">all 表示全部的元素</span><br><span class="line">#some</span><br><span class="line">select * from stuinfo where sid =some (select sid from stumarks where math&lt;60);</span><br><span class="line"></span><br><span class="line">select *from stuinfo where sid =any (select sid from stumarks where math&lt;60);</span><br><span class="line"></span><br><span class="line">#条件都满足</span><br><span class="line">select * from stuinfo where sid =all (select sid from stumarks where math&lt;60);</span><br><span class="line"></span><br><span class="line">查询数学90分以上的学生</span><br><span class="line">select * from  stuinfo where sid not in (select sid from stumarks where math&lt;90);</span><br><span class="line"></span><br><span class="line">select * from  stuinfo where sid != some (select sid from stumarks where math&lt;90);</span><br><span class="line">#some = in  !=some不等与 not in</span><br><span class="line">#!=all 等同 not in</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查询数学90以下的学生</span><br><span class="line">select * from  stuinfo where sid =some (select sid from stumarks where math in(select math from stumarks having math&lt;90));</span><br></pre></td></tr></table></figure>
<h3 id="3-exists-not-exists"><a href="#3-exists-not-exists" class="headerlink" title="(3)exists | not exists"></a>(3)exists | not exists</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">如果有人math超过100分,就显示所有学生的信息</span><br><span class="line">select * from stuinfo where exists(select * from stumarks where math&gt;=100);</span><br><span class="line">#成绩未达到100分就显示</span><br><span class="line">select * from stuinfo where not exists(select * from stumarks where math&gt;=100);</span><br></pre></td></tr></table></figure>
<h3 id="4-子查询分类"><a href="#4-子查询分类" class="headerlink" title="(4)子查询分类"></a>(4)子查询分类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.标量子查询:子查询返回的值只有一个 sid = </span><br><span class="line">2.列子查询:子查询返回一个列表 sid in (3,4)</span><br><span class="line">3.行子查询:查询多个条件由多个字段组成的行形成</span><br><span class="line"></span><br><span class="line">找出语文成绩最高的男生和女生:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select * from stuinfo where sid in (select sid from stumarks where ch in ( select max(ch) from stuinfo left join stumarks using(sid) group by sex));</span><br></pre></td></tr></table></figure>
<h2 id="4-视图"><a href="#4-视图" class="headerlink" title="4.视图"></a>4.视图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.视图是一张虚拟的表,他表示一张表的部分数据或多张表的综合数据,</span><br><span class="line">视图的结构是建立在表的基础上</span><br><span class="line">2.视图中没有数据,只有表结构,视图中的数据在基表中获取</span><br><span class="line">3.一张表可以创建多个视图,一个视图可以引用多张表</span><br></pre></td></tr></table></figure>
<h3 id="1-创建视图"><a href="#1-创建视图" class="headerlink" title="(1)创建视图"></a>(1)创建视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create [or replace] view `视图名`</span><br><span class="line">as</span><br><span class="line">sql语句</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create view stu_view_1</span><br><span class="line">as</span><br><span class="line">select sid,sname,age,sex,city,ch,math from stuinfo left join stumarks using(sid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#视图创建完毕后,会在对应的文件夹中保存一个.frm的文件,子文件是视图的结构</span><br></pre></td></tr></table></figure>
<h3 id="2-查询"><a href="#2-查询" class="headerlink" title="(2)查询"></a>(2)查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from `stu_view_1`;</span><br></pre></td></tr></table></figure>
<h3 id="3-修改视图"><a href="#3-修改视图" class="headerlink" title="(3)修改视图"></a>(3)修改视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter view stu_view_1</span><br><span class="line">as</span><br><span class="line">select * from stuinfo;</span><br></pre></td></tr></table></figure>
<h3 id="4-查看视图的信息"><a href="#4-查看视图的信息" class="headerlink" title="(4)查看视图的信息"></a>(4)查看视图的信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">show create view stu_view_1\G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create view stu_view_1\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                View: stu_view_1</span><br><span class="line">         Create View: CREATE ALGORITHM=UNDEFINED DEFINER=`root`@`localhost` SQL</span><br><span class="line">SECURITY DEFINER VIEW `stu_view_1` AS select `stuinfo`.`sid` AS `sid`,`stuinfo`.</span><br><span class="line">`sname` AS `sname`,`stuinfo`.`sex` AS `sex`,`stuinfo`.`age` AS `age`,`stuinfo`.`</span><br><span class="line">city` AS `city` from `stuinfo`</span><br><span class="line">character_set_client: gbk</span><br><span class="line">collation_connection: gbk_chinese_ci</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="5-查看视图的结构"><a href="#5-查看视图的结构" class="headerlink" title="(5)查看视图的结构"></a>(5)查看视图的结构</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">desc stu_view_1;</span><br><span class="line"></span><br><span class="line">mysql&gt; desc stu_view_1;</span><br><span class="line">+-------+-----------------------+------+-----+---------+-------+</span><br><span class="line">| Field | Type                  | Null | Key | Default | Extra |</span><br><span class="line">+-------+-----------------------+------+-----+---------+-------+</span><br><span class="line">| sid   | int(11)               | NO   |     | 0       |       |</span><br><span class="line">| sname | varchar(255)          | YES  |     | NULL    |       |</span><br><span class="line">| sex   | enum(&apos;male&apos;,&apos;female&apos;) | YES  |     | NULL    |       |</span><br><span class="line">| age   | tinyint(4)            | YES  |     | NULL    |       |</span><br><span class="line">| city  | varchar(64)           | YES  |     | NULL    |       |</span><br><span class="line">+-------+-----------------------+------+-----+---------+-------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="6-查找视图"><a href="#6-查找视图" class="headerlink" title="(6)查找视图;"></a>(6)查找视图;</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">show tables;#它也可以查看视图</span><br><span class="line"></span><br><span class="line">select table_name from information_schema.views;</span><br><span class="line"></span><br><span class="line">show table status where comment=&apos;view&apos;\G;</span><br></pre></td></tr></table></figure>
<h3 id="7-删除视图"><a href="#7-删除视图" class="headerlink" title="(7)删除视图"></a>(7)删除视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop view stu_view_1;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">找出语文成绩最高的男生和女生:</span><br><span class="line">select * from stu_view_1 where(sex,ch) in (select sex,max(ch)from stu_view_1 group by sex);</span><br><span class="line">#把查询当作是数据源,命名为t</span><br><span class="line">select * from (select * from stu_view_1 order by ch desc) t group by sex;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create view vw_1</span><br><span class="line">as</span><br><span class="line">select * from stu_view_1 order by ch desc;</span><br></pre></td></tr></table></figure>
<h3 id="8-视图算法理论"><a href="#8-视图算法理论" class="headerlink" title="(8)视图算法理论"></a>(8)视图算法理论</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.merge:合并算法(将视图语句与外层语句合并执行)</span><br><span class="line">2.temptable:临时表算法(将视图执行的结果作为一个临时表,再执行外层语句)</span><br><span class="line">3.undefined:未定义算法,由mysql自己决定,一般使用的都是merge</span><br><span class="line"></span><br><span class="line">#给视图指定算法</span><br><span class="line">create or replace algorithm=merge view vm_2</span><br><span class="line">as</span><br><span class="line">select * from stuinfo order by sid desc;</span><br></pre></td></tr></table></figure>
<h3 id="5-事务"><a href="#5-事务" class="headerlink" title="5.事务"></a>5.事务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">什么是事务?</span><br><span class="line">1.事务是一个不可拆分的工作单元;</span><br><span class="line">2.事务是作为一个整体向系统提交的,要么一起执行,要么一起不执行;</span><br><span class="line">3.事务是不支持嵌套的</span><br></pre></td></tr></table></figure>
<h3 id="1-事务的特性"><a href="#1-事务的特性" class="headerlink" title="(1)事务的特性"></a>(1)事务的特性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.原子性:不可拆分</span><br><span class="line">2.一致性:要么一起执行,要么一起不执行</span><br><span class="line">3.隔离性:事务彼此没关系</span><br><span class="line">4.永久性:一旦执行成功,不可修改</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#事务先要开启</span><br><span class="line">start transaction;</span><br><span class="line">#语句</span><br><span class="line">insert into stuinfo values(null,&apos;百强&apos;,1,18,&apos;黑龙江&apos;);</span><br><span class="line">insert into stuinfo values(null,&apos;百强1&apos;,2,18,&apos;黑龙江&apos;);</span><br><span class="line">insert into stuinfo values(null,&apos;百强2&apos;,3,18,&apos;黑龙江&apos;);</span><br><span class="line">#不成功回滚</span><br><span class="line">rollback;</span><br><span class="line">#成功-&gt;提交</span><br><span class="line">commit;</span><br><span class="line"></span><br><span class="line">#注意</span><br><span class="line">事务只能在innodb引擎下使用</span><br></pre></td></tr></table></figure>
<h3 id="2-自动提交事务"><a href="#2-自动提交事务" class="headerlink" title="(2)自动提交事务"></a>(2)自动提交事务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查看自动提交事务是否开启</span><br><span class="line">show variables like &apos;autocommit&apos;;</span><br><span class="line"></span><br><span class="line">#如果是关的</span><br><span class="line">set autocommit=0|1</span><br></pre></td></tr></table></figure>
<h2 id="6-索引"><a href="#6-索引" class="headerlink" title="6.索引"></a>6.索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">优点:加快了mysql的查找速度</span><br><span class="line">缺点:</span><br><span class="line">1.更多的储存空间来储存索引字段名</span><br><span class="line">2.myisam使得insert,update,delete的速度变慢了(查询操作占用90%,cud操作加起来占用10%的操作还未必能达到)</span><br></pre></td></tr></table></figure>
<h3 id="1-创建索引的原则"><a href="#1-创建索引的原则" class="headerlink" title="(1)创建索引的原则"></a>(1)创建索引的原则</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#适合</span><br><span class="line">1.用于频繁查找的列(字段)</span><br><span class="line">2.用于条件判断的列(字段)</span><br><span class="line">3.用于排序的列(字段)</span><br><span class="line">#不适合</span><br><span class="line">1.列中的数据并不多</span><br><span class="line">2.表中的数据量很小</span><br></pre></td></tr></table></figure>
<h3 id="2-索引的类型"><a href="#2-索引的类型" class="headerlink" title="(2)索引的类型"></a>(2)索引的类型</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.普通索引</span><br><span class="line">create index isex on stuinfo(sex);</span><br><span class="line"></span><br><span class="line">alter table stuinfo add index isname(sname);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2.唯一索引</span><br><span class="line">unique</span><br><span class="line">#创建方法如上</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3.主键索引</span><br><span class="line">primary key</span><br><span class="line">#创建方法如上</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4.全文索引</span><br><span class="line">#xunsearch是一种工具</span><br><span class="line"></span><br><span class="line">fulltext key</span><br><span class="line">只能在myisam表引擎下使用(innodb,myisam创建的话都能创建,但是innodb中无效),使用like的时候提升效率.#  where nama like &apos;%你%&apos;;</span><br><span class="line">create FULLTEXT KEY zu on stuinfo(age,city);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5.创建多列索引(组合索引)</span><br><span class="line">create index zu on stuinfo(age,city);</span><br><span class="line">alter table stuinfo add index isname(sname,city);</span><br></pre></td></tr></table></figure>
<h3 id="3-删除索引"><a href="#3-删除索引" class="headerlink" title="(3)删除索引"></a>(3)删除索引</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop index zu on stuinfo;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#mysql优化</span><br><span class="line"></span><br><span class="line">innodb=&gt;执行 insert(多条) update delete 非常快</span><br><span class="line">myisam=&gt;执行 insert(单次) select  非常快</span><br><span class="line"></span><br><span class="line">1.mysql需要搭建在远程的服务器中</span><br><span class="line">2.1mysql台服务器中的所有表类型全部是innodb,其它4台服务器中的表全市myisam的</span><br><span class="line"></span><br><span class="line">主从复制(一主多从)(双主多从)</span><br><span class="line">master(主的mysql服务器 innodb) IO</span><br><span class="line">#从服务器监听主服务器</span><br><span class="line">slave(从服务器是myisam)  10.11.58.1 () IO</span><br><span class="line">slave(从服务器是myisam)  10.11.58.2</span><br><span class="line">slave(从服务器是myisam)</span><br><span class="line">slave(从服务器是myisam)</span><br><span class="line"></span><br><span class="line">从服务器(myisam)sub监听主服务器</span><br><span class="line"></span><br><span class="line">监听什么?</span><br><span class="line">ip地址</span><br><span class="line">干吗了?</span><br><span class="line">主服务器插入,修改,删除一条,从服务器插入,修改,删除一条.</span><br><span class="line"></span><br><span class="line">从服务器主要是用来查询的.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">innodb 和myisam有什么区别吗?</span><br><span class="line">表文件,数据存储方式不同.</span><br><span class="line">innodb可以使用外键,事务,唯一键</span><br><span class="line">myisam可以使用全文索引</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql怎么优化? IO</span><br><span class="line">添加索引,常用被查询的,数据量大的</span><br><span class="line">分表: 垂直分表和水平分表</span><br><span class="line">垂直分表是分字段</span><br><span class="line">水平分表是分数据的数量</span><br><span class="line"></span><br><span class="line">数据库分库,主从</span><br><span class="line"></span><br><span class="line">硬件方面考虑,固态硬盘比机械强</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/05/21/MySQL第四课/" data-id="cjhfjx3de0002w4qx0b7jbs4h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python基础17" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/05/21/python基础17/" class="article-date">
  <time datetime="2018-05-21T01:03:38.310Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#Lesson 17</p>
<hr>
<p>##第十七章</p>
<p>###【3】线程</p>
<p>####线程锁解决数据混乱</p>
<p>threading.Lock()互斥锁</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">两个线程同时工作，一个存钱，一个取钱</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">可能导致数据异常</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">思路：加锁，</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment">#锁对象</span></span><br><span class="line">lock = threading.Lock()</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        <span class="comment"># 锁</span></span><br><span class="line">        <span class="comment"># 确保了这段代码只能由一个线程从头到尾的完整执行</span></span><br><span class="line">        <span class="comment"># 阻止了多线程的并发执行，包含锁的某段代码实际上只能以单线程模式执行，所以效率大大滴降低了</span></span><br><span class="line">        <span class="comment"># 由于可以存在多个锁，不同线程持有不同的锁，并试图获取其他的锁，可能造成死锁，导致多个线程挂起。只能靠操作系统强制终止</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        lock.acquire()</span></span><br><span class="line"><span class="string">        try:</span></span><br><span class="line"><span class="string">            num = num + n    #  15 = 9 + 6</span></span><br><span class="line"><span class="string">            num = num - n    #  9</span></span><br><span class="line"><span class="string">        finally:</span></span><br><span class="line"><span class="string">            #修改完一定要释放锁</span></span><br><span class="line"><span class="string">            lock.release()</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#与上面代码功能相同，with lock可以自动上锁与解锁</span></span><br><span class="line">        <span class="keyword">with</span> lock:</span><br><span class="line">            num = num + n</span><br><span class="line">            num = num - n</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    t1 = threading.Thread(target=run, args=(<span class="number">6</span>,))</span><br><span class="line">    t2 = threading.Thread(target=run, args=(<span class="number">9</span>,))</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line">    print(<span class="string">"num ="</span>,num)</span><br></pre></td></tr></table></figure>
<p>####threadlocal</p>
<p>如果有一个全局变量的话，那么在线程中是可以共享的，那么就会造成数据混乱的可能。这时候我们可以使用threadlocal，它本身也是一个全局的对象，但是它可以给每个线程创建一个局部变量。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="comment">#创建一个全局的ThreadLocal对象</span></span><br><span class="line"><span class="comment">#每个线程有独立的存储空间</span></span><br><span class="line"><span class="comment">#每个线程对ThreadLocal对象都可以读写，但是互不影响</span></span><br><span class="line">local = threading.local()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(x, n)</span>:</span></span><br><span class="line">    x = x + n</span><br><span class="line">    x = x - n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="comment">#每个线程都有local.x，就是线程的局部变量</span></span><br><span class="line">    local.x = num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000000</span>):</span><br><span class="line">        run(local.x, n)</span><br><span class="line">    print(<span class="string">"%s-%d"</span>%(threading.current_thread().name, local.x))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    t1 = threading.Thread(target=func, args=(<span class="number">6</span>,))</span><br><span class="line">    t2 = threading.Thread(target=func, args=(<span class="number">9</span>,))</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"num ="</span>,num)</span><br><span class="line"></span><br><span class="line"><span class="comment">#作用：为每个线程绑定一个数据库链接，HTTP请求，用户身份信息等，这样一个线程的所有调用到的处理函数都可以非常方便地访问这些资源</span></span><br></pre></td></tr></table></figure>
<p>####客户端与服务器间的数据交互</p>
<p>客户端：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#server.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">server.bind((<span class="string">'172.16.61.1'</span>,<span class="number">8081</span>))</span><br><span class="line">server.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(ck)</span>:</span></span><br><span class="line">  data = clientSocket.recv(<span class="number">1024</span>)</span><br><span class="line">  print(<span class="string">"客户端说："</span> + data.decode(<span class="string">"utf-8"</span>))</span><br><span class="line">  sendData = input(<span class="string">"输入返回给客户端的数据"</span>)</span><br><span class="line">  <span class="keyword">if</span> len(sendData):</span><br><span class="line">    clientSocket.send(sendData.encode(<span class="string">"utf-8"</span>))</span><br><span class="line"></span><br><span class="line">print(<span class="string">"服务器启动成功，等待客户端的链接"</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">  clientSocket, clientAddress = server.accept()</span><br><span class="line">  <span class="comment">#print("%s --  %s 链接成功" % (str(clientSocket), clientAddress))</span></span><br><span class="line">  t = threading.Thread(target=run, args=(clientSocket,))</span><br><span class="line">  t.start()</span><br></pre></td></tr></table></figure>
<p>客户端：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#client.py</span></span><br><span class="line"><span class="comment">#客户端可以有多个</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client.connect((<span class="string">"192.168.3.3"</span>, <span class="number">8081</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    data = input(<span class="string">"请输入给服务器发送的数据"</span>)</span><br><span class="line">    client.send(data.encode(<span class="string">"utf-8"</span>))</span><br><span class="line">    info = client.recv(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">"服务器说："</span>, info.decode(<span class="string">"utf-8"</span>))</span><br></pre></td></tr></table></figure>
<p>####信号量控制线程数量</p>
<p>什么是信号量？</p>
<p>也可以叫信号灯，信号量是多线程环境下使用的一种设施。</p>
<p>我们打个比方，比如现在的路口是单行道，而且还是双行道，现在绿灯了，我们假设车的速度都是一样的，那么是不是两两一起过这个路口。</p>
<p>那么我们线程一样的，几个线程一起一执行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading,time</span><br><span class="line"></span><br><span class="line">sem = threading.Semaphore(<span class="number">2</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> sem:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">            print(<span class="string">'%s--%d'</span>%(threading.current_thread().name,i))</span><br><span class="line">            time.sleep(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        threading.Thread(target=run).start()</span><br></pre></td></tr></table></figure>
<p>####分界线控制运行数量</p>
<p>分解线这个我们很常见，它的作用就是讲什么分开。</p>
<p>我们这里的分界线，好比是游乐场玩过山车的，过山车上好比就是8个座位吧，那是不是凑够了8个人才能开一趟。</p>
<p>我们看看例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading,time</span><br><span class="line"></span><br><span class="line">bar = threading.Barrier(<span class="number">2</span>)<span class="comment">#凑够了三个一起执行</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"%s--start"</span> % (threading.current_thread().name))</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    bar.wait()   <span class="comment">#这里开始等待，达到条件了就可以释放了</span></span><br><span class="line">    print(<span class="string">"%s--end"</span> % (threading.current_thread().name))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        threading.Thread(target=run).start()</span><br></pre></td></tr></table></figure>
<p>####延时执行线程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"我被延迟了"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">go</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"我是正常的执行的"</span>)</span><br><span class="line"><span class="comment">#延时执行线程</span></span><br><span class="line">r = threading.Timer(<span class="number">5</span>, run)</span><br><span class="line">g = threading.Timer(<span class="number">1</span>, go)</span><br><span class="line">r.start()</span><br><span class="line">g.start()</span><br><span class="line"></span><br><span class="line">r.join()</span><br><span class="line">g.join()</span><br><span class="line">print(<span class="string">"结束"</span>)</span><br></pre></td></tr></table></figure>
<p>####事件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading, time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#事件对象</span></span><br><span class="line">    event = threading.Event()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">            <span class="comment">#阻塞，等待事件的触发</span></span><br><span class="line">            event.wait()</span><br><span class="line">            <span class="comment">#重置</span></span><br><span class="line">            event.clear()<span class="comment">#这里是清除事件的</span></span><br><span class="line">            print(<span class="string">"第%d次循环"</span>%i)</span><br><span class="line">    t = threading.Thread(target=run).start()</span><br><span class="line">    <span class="keyword">return</span> event</span><br><span class="line"></span><br><span class="line">e = func()</span><br><span class="line"></span><br><span class="line"><span class="comment">#触发事件</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    e.set()<span class="comment">#这里我们知道这个事件对象是e，那么直接就可以设置事件对象</span></span><br></pre></td></tr></table></figure>
<p>####生产者于消费者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading,queue,time,random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#这个是生产者</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">product</span><span class="params">(id,q)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        num = random.randint(<span class="number">0</span>,<span class="number">10000</span>)</span><br><span class="line">        q.put(num)</span><br><span class="line">        print(<span class="string">'生产者%d生产的%d已经放入队列了'</span>%(id,num))</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="comment">#队列任务完成时</span></span><br><span class="line">    q.task_done()</span><br><span class="line"><span class="comment">#这个是消费者</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">customer</span><span class="params">(id,q)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        item = q.get()</span><br><span class="line">        print(<span class="string">'消费者%d消费了%d'</span> % (id, item))</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="comment">#队列任务完成时</span></span><br><span class="line">    q.task_done()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment">#实例化消息队列</span></span><br><span class="line">    q = queue.Queue()</span><br><span class="line">    <span class="comment">#启动生产者</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        threading.Thread(target=product,args=(i,q)).start()</span><br><span class="line">    <span class="comment">#启动消费者</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        threading.Thread(target=customer, args=(i, q)).start()</span><br></pre></td></tr></table></figure>
<p>####线程调度</p>
<p>我们有的时候需要在第一个线程中运行完一个程序，然后在第二个线程里面在运行，让这两个线程相互切换。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading,time</span><br><span class="line"></span><br><span class="line">con = threading.Condition()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> con:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>,<span class="number">2</span>):</span><br><span class="line">            print(threading.current_thread().name,i)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="comment">#1、我先执行，打印出来以后我开始等待</span></span><br><span class="line">            con.wait()</span><br><span class="line">            <span class="comment">#4、我接受到了通知我🈶开始走了。</span></span><br><span class="line">            con.notify()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">go</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> con:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">10</span>,<span class="number">2</span>):</span><br><span class="line">            print(threading.current_thread().name,i)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="comment">#2、在你等待的时间里面我走完了，那么我高数你，你也走吧</span></span><br><span class="line">            con.notify()</span><br><span class="line">            <span class="comment">#3、在你执行的时候我开始等待</span></span><br><span class="line">            con.wait()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    r = threading.Thread(target=run).start()</span><br><span class="line">    g = threading.Thread(target=go).start()</span><br></pre></td></tr></table></figure>
<p>###【4】协程</p>
<p>协程不是进程或线程，其执行过程更类似于子例程（就是某个主程序中的一部分代码，函数也是一个子例程），或者说不带返回值的函数调用。</p>
<p>协成的执行看起来好像是两个线程是工作，实际上是在一个线程中完成的。</p>
<p>python需要使用一个叫genertor生成器来实现的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">子程序/函数：在所有语言中都是层级调用，比如A调用B，在B执行的过程中又可以调用C，C执行完毕返回，B执行完毕返回，最后是A执行完毕。是通过栈实现的，一个线程就是执行一个子程序，子程序调用总是一个入口，一次返回，调用的顺序是明确的</span><br><span class="line"></span><br><span class="line">概述：看上去也是子程序，但执行过程中，在子程序的内部可中断，然后转而执行别的子程序，不是函数调用</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">C</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"C--start"</span>)</span><br><span class="line">    print(<span class="string">"C--end"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">B</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"B--start"</span>)</span><br><span class="line">    C()</span><br><span class="line">    print(<span class="string">"B--end"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">A</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"A--start"</span>)</span><br><span class="line">    B()</span><br><span class="line">    print(<span class="string">"A--end"</span>)</span><br><span class="line"></span><br><span class="line">A()</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">A</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">1</span>)</span><br><span class="line">    print(<span class="number">2</span>)</span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">B</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"x"</span>)</span><br><span class="line">    print(<span class="string">"y"</span>)</span><br><span class="line">    print(<span class="string">"z"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line">x</span><br><span class="line">y</span><br><span class="line">z</span><br><span class="line"><span class="number">3</span></span><br><span class="line">执行出这个结果</span><br><span class="line">但是A中是没有B的调用</span><br><span class="line">看起来A、B执行过程有点像线程，但协程的特点在于是一个线程执行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">与线程相比，协程的执行效率极高，因为只有一个线程，也不存在同时写变量的冲突，在协程中共享资源不加锁，只需要判断状态</span><br></pre></td></tr></table></figure>
<p>Python对协程的支持是通过generator实现的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">10</span></span><br><span class="line">    print(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">20</span></span><br><span class="line">    print(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#协程的最简单风格，控制函数的阶段执行，节约线程或者进程的切换</span></span><br><span class="line"><span class="comment">#返回值是一个生成器</span></span><br><span class="line">m = run()</span><br><span class="line">print(next(m))</span><br><span class="line">print(next(m))</span><br><span class="line">print(next(m))</span><br></pre></td></tr></table></figure>
<p>####数据传输</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment">#空变量，存储的作用data始终为空</span></span><br><span class="line">    data = <span class="string">""</span></span><br><span class="line">    r = <span class="keyword">yield</span> data</span><br><span class="line">    <span class="comment">#r = a</span></span><br><span class="line">    print(<span class="number">1</span>, r, data)</span><br><span class="line">    r = <span class="keyword">yield</span> <span class="string">"aa"</span></span><br><span class="line">    <span class="comment">#r = b</span></span><br><span class="line">    print(<span class="number">2</span>, r, data)</span><br><span class="line">    r = <span class="keyword">yield</span> <span class="string">"bb"</span></span><br><span class="line">    <span class="comment">#r = c</span></span><br><span class="line">    print(<span class="number">3</span>, r, data)</span><br><span class="line">    r = <span class="keyword">yield</span> <span class="string">"cc"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = run()</span><br><span class="line"><span class="comment">#启动m</span></span><br><span class="line">print(m.send(<span class="keyword">None</span>))</span><br><span class="line">print(m.send(<span class="string">"a"</span>))</span><br><span class="line">print(m.send(<span class="string">"b"</span>))</span><br><span class="line">print(m.send(<span class="string">"c"</span>))</span><br><span class="line">print(<span class="string">"******"</span>)</span><br></pre></td></tr></table></figure>
<p>####生产者与消费者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">product</span><span class="params">(c)</span>:</span></span><br><span class="line">    c.send(<span class="keyword">None</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        print(<span class="string">"生产者产生数据%d"</span>%i)</span><br><span class="line">        r = c.send(str(i))</span><br><span class="line">        print(<span class="string">"消费者消费了数据%s"</span>%r)</span><br><span class="line">    c.close()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">customer</span><span class="params">()</span>:</span></span><br><span class="line">    data = <span class="string">""</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        n = <span class="keyword">yield</span> data</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> n:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        print(<span class="string">"消费者消费了%s"</span>%n)</span><br><span class="line">        data = <span class="string">"200"</span></span><br><span class="line">c = customer()</span><br><span class="line">product(c)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/05/21/python基础17/" data-id="cjhfjx3e3000dw4qxercfmvtx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python基础16" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2018/05/21/python基础16/" class="article-date">
  <time datetime="2018-05-21T01:03:26.220Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#Lesson 19</p>
<hr>
<p>##第十七章</p>
<p>###【1】多任务的原理</p>
<p>现代操作系统(Windows、Mac OS X、Linux、UNIX等)都支持“多任务”</p>
<p>什么叫多任务？？？<br>操作系统同时可以运行多个任务</p>
<p>单核CPU实现多任务原理：操作系统轮流让各个任务交替执行，QQ执行2us，切换到微信，在执行2us，再切换到陌陌，执行2us……。表面是看，每个任务反复执行下去，但是CPU调度执行速度太快了，导致我们感觉就行所有任务都在同时执行一样</p>
<p>多核CPU实现多任务原理：真正的秉性执行多任务只能在多核CPU上实现，但是由于任务数量远远多于CPU的核心数量，所以，操作西永也会自动把很多任务轮流调度到每个核心上执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">并发：看上去一起执行，任务数多于CPU核心数</span><br><span class="line">并行：真正一起执行，任务数小于等于CPU核心数</span><br></pre></td></tr></table></figure>
<p>实现多任务的方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、多进程模式 </span><br><span class="line"><span class="number">2</span>、多线程模式  </span><br><span class="line"><span class="number">3</span>、协程模式</span><br><span class="line"><span class="number">4</span>、多进程+多线程模式</span><br></pre></td></tr></table></figure>
<p>###【2】进程</p>
<p>对于操作系统而言，一个任务就是一个进程，比如我们在windows下任务管理器中的都是一个一个的进程。</p>
<p>进程是系统中程序执行和资源分配的基本单位。每个进程都有自己的数据段、代码段、和堆栈段。</p>
<p>####单任务现象</p>
<p>我们看一段代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        print(<span class="string">"随便写点啥"</span>)</span><br><span class="line">        sleep(<span class="number">1.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        print(<span class="string">"在来电啥"</span>)</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 不会执行到run方法，只有上面的while循环结束才可以执行</span></span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>
<p>####启动进程实现多任务</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">multiprocessing 库</span></span><br><span class="line"><span class="string">跨平台版本的多进程模块，提供了一个Process类来代表一个进程对象</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment">#子进程需要执行的买吗</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(str)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        <span class="comment"># os.getpid()获取当前进程id号</span></span><br><span class="line">        <span class="comment"># os.getppid()获取当前进程的父进程id号</span></span><br><span class="line">        print(<span class="string">"Hal is a %s man--%s--%s"</span>%(str, os.getpid(),os.getppid()))</span><br><span class="line">        sleep(<span class="number">1.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"主(父)进程启动-%s"</span>%(os.getpid()))</span><br><span class="line">    <span class="comment">#创建子进程</span></span><br><span class="line">    <span class="comment">#target说明进程执行的任务</span></span><br><span class="line">    p = Process(target=run, args=(<span class="string">"nice"</span>,))</span><br><span class="line">    <span class="comment">#启动进程</span></span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        print(<span class="string">"在来电啥"</span>)</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>####父子进程的先后顺序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(str)</span>:</span></span><br><span class="line">    print(<span class="string">"子进程启动"</span>)</span><br><span class="line">    sleep(<span class="number">3</span>)</span><br><span class="line">    print(<span class="string">"子进程结束"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"父进程启动"</span>)</span><br><span class="line"></span><br><span class="line">    p = Process(target=run)</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#join父进程的结束不能影响子进程，让父进程等待子进程结束再执行父进程</span></span><br><span class="line">    p.join()</span><br><span class="line">    print(<span class="string">"父进程结束"</span>)</span><br></pre></td></tr></table></figure>
<p>####全局变量在多个进程中不能共享</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">num = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"子进程开始"</span>)</span><br><span class="line">    <span class="comment">#即使使用了global，那还是在函数内部创建了局部变量，因为不在一个进程中。</span></span><br><span class="line">    <span class="keyword">global</span> num <span class="comment"># num = 100</span></span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    print(num)</span><br><span class="line">    print(<span class="string">"子进程结束"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"父进程开始"</span>)</span><br><span class="line"></span><br><span class="line">    p = Process(target=run)</span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在子进程中欧修改全局变量对父进程中的全局变量没有影响</span></span><br><span class="line">    <span class="comment"># 在创建子进程时对全局变量做了一个备份，父进程中的与子进程中的num是完全不同的两个变量</span></span><br><span class="line">    print(<span class="string">"父进程结束--%d"</span>%num)</span><br></pre></td></tr></table></figure>
<p>####启动大量子进程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> os, time, random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(name)</span>:</span></span><br><span class="line">    print(<span class="string">"子进程%d启动--%s"</span> % (name, os.getpid()))</span><br><span class="line">    start = time.time()</span><br><span class="line">    time.sleep(random.choice([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]))</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">"子进程%d结束--%s--耗时%.2f"</span> % (name, os.getpid(), end-start))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"父进程启动"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建多个进程</span></span><br><span class="line">    <span class="comment">#进程池</span></span><br><span class="line">    <span class="comment">#表示可以同时执行的进程数量</span></span><br><span class="line">    <span class="comment">#Pool默认大小是CPU核心数</span></span><br><span class="line">    pp = Pool(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        <span class="comment">#创建进程，放入进程池同意管理</span></span><br><span class="line">        pp.apply_async(run,args=(i,))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#在调用join之前必须先调用close,调用close之后就不能再继续添加新的进程了</span></span><br><span class="line">    pp.close()</span><br><span class="line">    <span class="comment">#进程池对象调用join，会等待进程池中所有的子进程结束完毕再去执行父进程</span></span><br><span class="line">    pp.join()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"父进程结束"</span>)</span><br></pre></td></tr></table></figure>
<p>####拷贝文件</p>
<p>普通的文件拷贝</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os, time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#实现文件的拷贝</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copyFile</span><span class="params">(rPath, wPath)</span>:</span></span><br><span class="line">    fr = open(rPath, <span class="string">"rb"</span>)</span><br><span class="line">    fw = open(wPath, <span class="string">"wb"</span>)</span><br><span class="line">    context = fr.read()</span><br><span class="line">    fw.write(context)</span><br><span class="line">    fr.close()</span><br><span class="line">    fw.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">path = <span class="string">r"C:\Users\xlg\Desktop\Python-1704\day20\2、进程\file"</span></span><br><span class="line">toPath = <span class="string">r"C:\Users\xlg\Desktop\Python-1704\day20\2、进程\toFile"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#读取path下的都有的文件</span></span><br><span class="line">filesList = os.listdir(path)</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动for循环处理每一个文件</span></span><br><span class="line">start = time.time()</span><br><span class="line"><span class="keyword">for</span> fileName <span class="keyword">in</span> filesList:</span><br><span class="line">    copyFile(os.path.join(path,fileName), os.path.join(toPath,fileName))</span><br><span class="line">end = time.time()</span><br><span class="line">print(<span class="string">"总耗时：%0.2f"</span> % (end-start))</span><br></pre></td></tr></table></figure>
<p>我们看一下多进程版本高的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, time</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line"><span class="comment">#实现文件的拷贝</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">copyFile</span><span class="params">(rPath, wPath)</span>:</span></span><br><span class="line">    fr = open(rPath, <span class="string">"rb"</span>)</span><br><span class="line">    fw = open(wPath, <span class="string">"wb"</span>)</span><br><span class="line">    context = fr.read()</span><br><span class="line">    fw.write(context)</span><br><span class="line">    fr.close()</span><br><span class="line">    fw.close()</span><br><span class="line"></span><br><span class="line">path = <span class="string">r"C:\Users\xlg\Desktop\Python-1704\day20\2、进程\file"</span></span><br><span class="line">toPath = <span class="string">r"C:\Users\xlg\Desktop\Python-1704\day20\2、进程\toFile"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># 读取path下的都有的文件</span></span><br><span class="line">    filesList = os.listdir(path)</span><br><span class="line"></span><br><span class="line">    start = time.time()</span><br><span class="line">    pp = Pool(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">for</span> fileName <span class="keyword">in</span> filesList:</span><br><span class="line">        pp.apply_async(copyFile, args=(os.path.join(path,fileName), os.path.join(toPath,fileName)))</span><br><span class="line"></span><br><span class="line">    pp.close()</span><br><span class="line">    pp.join()</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(<span class="string">"总耗时：%0.2f"</span> % (end-start))</span><br></pre></td></tr></table></figure>
<p>####封装进程对象</p>
<p>为什么要封装了？</p>
<p>就是为了看的更加的清晰，我们上面的例子里面一写就一大堆并不好看。</p>
<p>我们先封装：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#myProcess.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> os, time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyProcess</span><span class="params">(Process)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        Process.__init__(self)</span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"子进程(%s-%s)启动"</span> % (self.name, os.getpid()))</span><br><span class="line">        <span class="comment">#子进程的功能</span></span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        print(<span class="string">"子进程(%s-%s)结束"</span> % (self.name, os.getpid()))</span><br></pre></td></tr></table></figure>
<p>封装好在下面使用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> myProcess <span class="keyword">import</span> MyProcess</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    print(<span class="string">"父进程启动"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建子进程</span></span><br><span class="line">    p = MyProcess(<span class="string">"test"</span>)</span><br><span class="line">    <span class="comment"># 自动调用p进程对象的run方法</span></span><br><span class="line">    p.start()</span><br><span class="line">    p.join()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"父进程结束"</span>)</span><br></pre></td></tr></table></figure>
<p>####进程间的通信</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="keyword">import</span> os, time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(<span class="string">"启动写子进程%s"</span> % (os.getpid()))</span><br><span class="line">    <span class="keyword">for</span> chr <span class="keyword">in</span> [<span class="string">"A"</span>, <span class="string">"B"</span>, <span class="string">"C"</span>, <span class="string">"D"</span>]:</span><br><span class="line">        q.put(chr)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    print(<span class="string">"结束写子进程%s"</span> % (os.getpid()))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(q)</span>:</span></span><br><span class="line">    print(<span class="string">"启动读子进程%s"</span> % (os.getpid()))</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">        value = q.get(<span class="keyword">True</span>)</span><br><span class="line">        print(<span class="string">"value = "</span> + value)</span><br><span class="line">    print(<span class="string">"结束读子进程%s"</span> % (os.getpid()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment">#父进程创建队列，并传递给子进程</span></span><br><span class="line">    q = Queue()</span><br><span class="line">    pw = Process(target=write, args=(q,))</span><br><span class="line">    pr = Process(target=read, args=(q,))</span><br><span class="line"></span><br><span class="line">    pw.start()</span><br><span class="line">    pr.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    pw.join()</span><br><span class="line">    <span class="comment">#pr进程里是个死循环，无法等待其结束，只能强行结束</span></span><br><span class="line">    pr.terminate()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"父进程结束"</span>)</span><br></pre></td></tr></table></figure>
<p>###【3】线程</p>
<p>在一个进程的内部，要同时干多件事，就需要同时运行多个“子任务”，我们把进程内的这些“子任务”叫做线程</p>
<p>线程通常叫做轻型的进程。线程是共享内存空间的并发执行的多任务，每一个线程都共享一个进程的资源</p>
<p>线程是最小的执行单元，而进程由至少一个线程组成。如何调度进程和线程，完全由操作系统决定，程序自己不能决定什么时候执行，执行多长时间</p>
<p>模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、_thread模块       低级模块</span><br><span class="line"><span class="comment">#低级模块就是接近底层的模块，越是底层就越难</span></span><br><span class="line"><span class="number">2</span>、threading模块     高级模块，对_thread进行了封装</span><br></pre></td></tr></table></figure>
<p>####启动线程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading,time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(num)</span>:</span></span><br><span class="line">    print(<span class="string">"子线程(%s)开始"</span> % (threading.current_thread().name))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#实现线程的功能</span></span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    print(<span class="string">"打印"</span>, num)</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"子线程(%s)结束"</span> % (threading.current_thread().name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment">#任何进程默认就会启动一个线程，称为主线程，主线程可以启动新的子线程</span></span><br><span class="line">    <span class="comment">#current_thread()：返回返回当前线程的实例</span></span><br><span class="line">    print(<span class="string">"主线程(%s)启动"</span> % (threading.current_thread().name))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建子线程                     线程的名称</span></span><br><span class="line">    t = threading.Thread(target=run, name=<span class="string">"runThread"</span>, args=(<span class="number">1</span>,))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#等待线程结束</span></span><br><span class="line">    t.join()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"主线程(%s)结束"</span> % (threading.current_thread().name))</span><br></pre></td></tr></table></figure>
<p>####线程共享数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">多线程和多进程最大的不同在于，多进程中，同一个变量，各自有一份拷贝存在每个进程中，互不影响。而多线程中，所有变量都由所有线程共享。所以，任何一个变量都可以被任意一个线程修改，因此，线程之间共享数据最大的危险在于多个线程同时修改一个变量，容易把内容改乱了。</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        num += n    <span class="comment">#  15 = 9 + 6</span></span><br><span class="line">        num -= n    <span class="comment">#  9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    t1 = threading.Thread(target=run, args=(<span class="number">6</span>,))</span><br><span class="line">    t2 = threading.Thread(target=run, args=(<span class="number">9</span>,))</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"num ="</span>,num)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">线程1   num = num + 6</span></span><br><span class="line"><span class="string">        num - 6  = 3</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">线程2   num = num + 9</span></span><br><span class="line"><span class="string">        3 - 9  =  -6</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://jyue0812.github.io/2018/05/21/python基础16/" data-id="cjhfjx3e1000cw4qxgu3zdzat" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="page-number" href="/blog/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/5/">5</a><a class="extend next" rel="next" href="/blog/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2018/06/19/2018-06-19/">(no title)</a>
          </li>
        
          <li>
            <a href="/blog/2018/06/05/flask配置套路/">(no title)</a>
          </li>
        
          <li>
            <a href="/blog/2018/06/04/2018-06-04/">(no title)</a>
          </li>
        
          <li>
            <a href="/blog/2018/05/21/jquery_3/">(no title)</a>
          </li>
        
          <li>
            <a href="/blog/2018/05/21/pymysql/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 ZY<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>



  </div>
</body>
</html>