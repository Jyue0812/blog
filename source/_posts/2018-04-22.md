2018年4月22日
#### 第0013题
第 0013 题： 用 Python 写一个爬图片的程序，爬 这个链接里的日本妹子图片 :-) http://tieba.baidu.com/p/2166231880

```
import urllib.request
from lxml import etree
# 获取网页源代码
def getHtml():
    url = "http://tieba.baidu.com/p/2166231880"
    headers = {"User-Agent" : "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4)"}

    request = urllib.request.Request(url, headers=headers)
    response = urllib.request.urlopen(request)
    content = response.read().decode("utf-8")
    return content

# 获取图片
def getImage():
    html = getHtml()
    html = etree.HTML(html)
    links = html.xpath('//img[@class="BDE_Image"]/@src')
    return links

# 下载保存图片
def downloadImage():
    images = getImage()
    for image in images:
        filename = image[-10:]
        with open(filename, 'wb') as f:
            headers = {"User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4)"}
            request = urllib.request.Request(image, headers=headers)
            response = urllib.request.urlopen(request)
            url = response.read()
            f.write(url)

downloadImage()
```

#### 第0010题
使用 Python 生成类似于下图中的字母验证码图片

```
import string
import random
from PIL import Image, ImageDraw, ImageFont

# 获得任意四个英文字母
def getLetters():
    letters = string.ascii_letters
    str1 = ""
    for i in range(4):
        a = random.choice(letters)
        str1 += a + '   '
    return str1

# 对图片进行处理
def dealImage(str):
    image = Image.open('image.png')
    draw = ImageDraw.Draw(image)
    myfont = ImageFont.truetype('C:/windows/fonts/Arial.ttf', size=40)
    width, height = image.size
    draw.text((width/2-90, height/2-20), str, font=myfont, fill="#ff0000")
    image.save('result.jpg', 'png')

en = getLetters()
dealImage(en)
```

#### 第0011题
敏感词文本文件 filtered_words.txt，里面的内容为以下内容，当用户输入敏感词语时，则打印出 Freedom，否则打印出 Human Rights。
北京
程序员
公务员
领导
牛比
牛逼
你娘
你妈
love
sex
jiangge

```
user_input = input("请输入一个词语：")
with open('filtered_words.txt') as fr:
    words = fr.readlines()
    count = 0
    for word in words:
        word = word.strip()
        if user_input == word:
            print("Freedom")
            count += 1
    if count == 0:
        print("Human Rights")
```

#### 第0012题
敏感词文本文件 filtered_words.txt，里面的内容 和 0011题一样，当用户输入敏感词语，则用 星号 * 替换，例如当用户输入「北京是个好城市」，则变成「**是个好城市」。

```
import re
user_input = input("请输入一个词语：")
with open('filtered_words.txt') as fr:
    words = fr.readlines()
    for word in words:
        word = word.strip()
        if re.search(word, user_input):
            result = re.sub(word, "*"*len(word), user_input)
            print(result)
```

#### 实验楼项目1
要求：
本实验用 50 行 Python 代码完成图片转字符画小工具。通过本实验将学习到 Linux 命令行操作，Python 基础，pillow 库的使用，argparse 库的使用。

实验知识点
本节实验中我们将实践以下知识：
Linux 命令行操作
Python 基础
pillow 库的使用
argparse 库的使用（参考教程）

```
from PIL import Image
import argparse

parser = argparse.ArgumentParser()
parser.add_argument('file')
parser.add_argument('-o', '--output')
parser.add_argument('--width', type = int, default = 80)
parser.add_argument('--height', type = int, default = 80)
args = parser.parse_args()
IMG = args.file
WIDTH = args.width
HEIGHT = args.height
OUTPUT = args.output

#字符画是一系列字符的组合，我们可以把字符看作是比较大块的像素，一个字符能表现一种颜色（暂且这么理解吧），字符的种类越多，可以表现的颜色也越多，图片也会更有层次感。

ascii_char = list("$@B%8&WM#*oahkbdpqwmZO0QLCJUYXzcvunxrjft/\|()1{}[]?-_+~<>i!lI;:,\"^`'. ")

def get_char(r,g,b,alpha = 256):
    if alpha == 0:
        return ' '
    length = len(ascii_char)
    #灰度值计算公式，因为人眼对RGB颜色的感知并不相同，所以转换的时候需要给予不同的权重。事实上这个原理普遍应用于计算机图像处理系统
    gray = int(0.2126 * r + 0.7152 * g + 0.0722 * b)
    unit = (256.0 + 1)/length
    return ascii_char[int(gray/unit)]

if __name__ == '__main__':
    im = Image.open(IMG)
    #PIL.Image.NEAREST:低质量 Image.ANTIALIAS:高质量
    im = im.resize((WIDTH,HEIGHT), Image.NEAREST)
    txt = ""
    for i in range(HEIGHT):
        for j in range(WIDTH):
            txt += get_char(*im.getpixel((j,i)))
        txt += '\n'

    print(txt)

    if OUTPUT:
        with open(OUTPUT,'w') as f:
            f.write(txt)
    else:
        with open("output.txt",'w') as f:
            f.write(txt)
```

#### 今日总结
1. 学到了灰度值公式 
2. argparse库用来对命令行进行解析